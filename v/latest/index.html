<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="John Doe" />
  <meta name="author" content="Jane Roe" />
  <meta name="dcterms.date" content="2021-02-20" />
  <meta name="keywords" content="markdown, publishing, manubot" />
  <title>Manuscript Title</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <!--
  Manubot generated metadata rendered from header-includes-template.html.
  Suggest improvements at https://github.com/manubot/manubot/blob/main/manubot/process/header-includes-template.html
  -->
  <meta name="dc.format" content="text/html" />
  <meta name="dc.title" content="Manuscript Title" />
  <meta name="citation_title" content="Manuscript Title" />
  <meta property="og:title" content="Manuscript Title" />
  <meta property="twitter:title" content="Manuscript Title" />
  <meta name="dc.date" content="2021-02-20" />
  <meta name="citation_publication_date" content="2021-02-20" />
  <meta name="dc.language" content="en-US" />
  <meta name="citation_language" content="en-US" />
  <meta name="dc.relation.ispartof" content="Manubot" />
  <meta name="dc.publisher" content="Manubot" />
  <meta name="citation_journal_title" content="Manubot" />
  <meta name="citation_technical_report_institution" content="Manubot" />
  <meta name="citation_author" content="John Doe" />
  <meta name="citation_author_institution" content="Department of Something, University of Whatever" />
  <meta name="citation_author_orcid" content="XXXX-XXXX-XXXX-XXXX" />
  <meta name="twitter:creator" content="@johndoe" />
  <meta name="citation_author" content="Jane Roe" />
  <meta name="citation_author_institution" content="Department of Something, University of Whatever" />
  <meta name="citation_author_institution" content="Department of Whatever, University of Something" />
  <meta name="citation_author_orcid" content="XXXX-XXXX-XXXX-XXXX" />
  <link rel="canonical" href="https://desanker.github.io/saotome1/" />
  <meta property="og:url" content="https://desanker.github.io/saotome1/" />
  <meta property="twitter:url" content="https://desanker.github.io/saotome1/" />
  <meta name="citation_fulltext_html_url" content="https://desanker.github.io/saotome1/" />
  <meta name="citation_pdf_url" content="https://desanker.github.io/saotome1/manuscript.pdf" />
  <link rel="alternate" type="application/pdf" href="https://desanker.github.io/saotome1/manuscript.pdf" />
  <link rel="alternate" type="text/html" href="https://desanker.github.io/saotome1/v/a654c17cb1a2333075a26f71fa1f793d3c65b7f3/" />
  <meta name="manubot_html_url_versioned" content="https://desanker.github.io/saotome1/v/a654c17cb1a2333075a26f71fa1f793d3c65b7f3/" />
  <meta name="manubot_pdf_url_versioned" content="https://desanker.github.io/saotome1/v/a654c17cb1a2333075a26f71fa1f793d3c65b7f3/manuscript.pdf" />
  <meta property="og:type" content="article" />
  <meta property="twitter:card" content="summary_large_image" />
  <link rel="icon" type="image/png" sizes="192x192" href="https://manubot.org/favicon-192x192.png" />
  <link rel="mask-icon" href="https://manubot.org/safari-pinned-tab.svg" color="#ad1457" />
  <meta name="theme-color" content="#ad1457" />
  <!-- end Manubot generated metadata -->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Manuscript Title</h1>
</header>
<p><small><em>
This manuscript
(<a href="https://desanker.github.io/saotome1/v/a654c17cb1a2333075a26f71fa1f793d3c65b7f3/">permalink</a>)
was automatically generated
from <a href="https://github.com/desanker/saotome1/tree/a654c17cb1a2333075a26f71fa1f793d3c65b7f3">desanker/saotome1@a654c17</a>
on February 20, 2021.
</em></small></p>
<h2 id="authors">Authors</h2>
<ul>
<li><p><strong>John Doe</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/XXXX-XXXX-XXXX-XXXX">XXXX-XXXX-XXXX-XXXX</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/johndoe">johndoe</a>
· <img src="images/twitter.svg" class="inline_icon" alt="Twitter icon" />
<a href="https://twitter.com/johndoe">johndoe</a><br>
<small>
Department of Something, University of Whatever
· Funded by Grant XXXXXXXX
</small></p></li>
<li><p><strong>Jane Roe</strong><br>
<img src="images/orcid.svg" class="inline_icon" alt="ORCID icon" />
<a href="https://orcid.org/XXXX-XXXX-XXXX-XXXX">XXXX-XXXX-XXXX-XXXX</a>
· <img src="images/github.svg" class="inline_icon" alt="GitHub icon" />
<a href="https://github.com/janeroe">janeroe</a><br>
<small>
Department of Something, University of Whatever; Department of Whatever, University of Something
</small></p></li>
</ul>
<h2 class="page_break_before" id="abstract">Abstract</h2>
<p>Summary of the NAP - to be added</p>
<h2 id="executive-summary">Executive Summary</h2>
<p>The Democratic Republic of São Tomé and Principe is an archipelago…</p>
<h2 id="framework-for-the-nap">Framework for the NAP</h2>
<h3 id="essential-functions-of-the-nap-process">Essential Functions of the NAP Process</h3>
<p>The process to embed adaptation into national policies has advanced in both developed and developing countries. Substantial headway has been made in the development of climate change adaptation (CCA) strategies and plans, which include legislation and national strategies. The National Adaptation Plan (NAP) for Sao Tome and Principe will follow a dynamic, iterative approach that imparts elements of continuous learning and improvement. Key to this, is the collection of lessons learned from community-based activities that will address the context-specific elements of climate change adaptation together with emerging barriers and limits to adaptation. Indeed, there is no single approach to adaptation planning due to the multifarious nature of adaptation, and more often a mixed approach of both top-down and bottom-up interactions occurs.</p>
<p>The ultimate objective for Sao Tome and Principe’s adaptation planning process is to shift from a project-based system towards a coordinated and coherent approach, across key vulnerable sectors and at all levels. Linkages with local, subnational and national levels of government, incorporating the full participation of a broad range of stakeholders is imperative. Such approaches that lean on the traditional knowledge and technical expertise of the Saotomean society from national government officials and stakeholders to civil society organizations, academia and private sector actors, will stimulate dynamic responses in terms of climate change adaptation options and advance societal goals.</p>
<p>While national governments largely adopt a coordinating role in adaptation planning and implementation, at the state and local levels climate change adaptation
responses have diverse processes and outcomes (Mimura et al., n.d.). Local actors face the complexity of adaptation with insufficient technical guidance and data on local vulnerabilities and potential impacts. Yet given the availability of information, local agencies and planners are inundated with adaptation options needed to address future climatic changes (Mimura et al., n.d.). This, coupled with the uncertain outcomes of their decisions and the complexities of dynamic interlocked systems, highlights the importance of strengthening vertical linkages within government and horizontal nodes between sectors, actors and policies functioning at comparable levels. Furthermore, enhanced action on adaptation should follow a country-driven, gender-sensitive, participatory approach, guided by the best available science and indigenous knowledge, taking into consideration vulnerable groups, communities and ecosystems (National Adaptation Plans, 2012).</p>
<h3 id="the-nap-as-the-umbrella-programme-for-adaptation">The NAP as the Umbrella Programme for Adaptation</h3>
<p>The NAP process in Sao Tome and Principe proposes a measured approach towards transforming the country’s ability to address climate change adaptation. In spite of gaps such as the lack of a comprehensive institutional framework to set up a coordinated and cross-sectoral approach to adaptation, and the need for a national investment plan to guide climate change adaptation investments, the NAP is veritably integral to ensure a cohesive approach to adaptation planning at all levels. The NAP intends to act as an umbrella programme for all climate change adaptation initiatives, projects and programs. It will enrich the collective actions undertaken and bridge the gaps with respect to climate data and information, capacity building, policy mainstreaming, adaptation finance and monitoring. In Sao Tome and Principe, the current institutional framework to support climate change adaptation include the following actors and their corresponding areas of work:</p>
<p>INSERT TABLE HERE</p>
<p>The NAP intends to build on Sao Tome and Principe’s third National Communication, which complements the adaptation measures recommended in the previous versions of the National Communication, as well as the NAPA and other relevant strategic documents. It will undertake scientific analysis on local vulnerabilities and climate change impacts in key sectors of the economy, including agriculture and livestock, water resources and coastal zones, among others.</p>
<h3 id="climate-change-adaptation-priorities-identified-in-sao-tome-and-principes-indc">Climate Change Adaptation Priorities Identified in Sao Tome and Principe’s INDC</h3>
<p>Sao Tome and Principe’s Intended Nationally Determined Contribution (INDC) spotlights climate change adaptation as a priority for national authorities. It calls
for financial resources as well as technology and capacity building support through international assistance, to implement adaptation and mitigation measures.
Adaptation measures in the INDC are aimed at improving the country’s ability to adapt to the adverse impacts of climate change and as a means to contribute to
national development. This rationale takes into consideration Sao Tome and Principe’s ecosystem services and its status as a sink of Greenhouse Gases (GHGs) with
the capacity to sequester CO2 from the atmosphere. As a Small Island Developing State (SIDS), the country demonstrates conditions of vulnerability across all
sectors of the national economy including agriculture and livestock; forest and soil; water, energy and fishing; coastal zone and population; and health and
education.</p>
<p>Contingent on international funding, Sao Tome and Principle pledges to implement the following actions in the short to medium term: (I) strengthen the National
Service of Civil Protection and Fire by 2025 to respond to fires and other environmental disasters, increasing resilience to climate change and contributing to
social well-being; (II) reduce the number of people living in vulnerable at-risk areas by providing housing in safer areas; (III) develop a national program for
sustainable management of forest and agroforestry ecosystems by 2025; (IV) introduce radar reflectors on board all fishing vessels by 2025, to reduce the number
of accidents at sea; and (V) train and equip fishermen to ensure safe fishing and proper use of fishing gear.</p>
<p>In conformance with the NAP technical guidelines, the NAP entails a medium- and long-term approach, integrated within national development planning processes and
strategies to reduce vulnerability to the adverse impacts of climate change. In the medium to long term, Sao Tome and Principe has committed to implement
adaptation activities subject to the availability of international support to subsidize its financial, technological and capacity-building needs. These include
actions to: (I) reduce the illegal and indiscriminate felling of trees by 15% by 2030; (II) develop scientific and technical research on adaptation of new
productive crop varieties with a broad spectrum of tolerance to adverse climate impacts by 2030; (III) promote forestry/planting of species resistant to dry and
low rainfall by 2030; (IV) improve pasture with grazing selection by applying rotation management of the plots by 2030; (V) increase the resilience to erosion
and maritime river and storm flooding of coastal areas through improved coastal protection for vulnerable communities; and (VI) reduce the use of nitrogen
fertilizers in agriculture by 2030.</p>
<h3 id="gaps-and-barriers-to-adaptation-as-identified-in-the-indc">Gaps and Barriers to Adaptation as Identified in the INDC</h3>
<ul>
<li>Limited availability and access to climate change information</li>
<li>Lack of access to a centralized database</li>
<li>Lack of capacity building for national experts on specific issues</li>
<li>Limited access to efficient and modern technologies</li>
<li>Inadequate technological skills in the national marketplace</li>
<li>Limited capacity of the National Climate Change Committee</li>
<li>Lack of policies and regulations for key sectors</li>
<li>Limited access to finance</li>
<li>Limited state budgets to create an enabling environment for private sector investment</li>
<li>Relatively long period for returns on investment</li>
</ul>
<h3 id="existing-initiatives-and-projects-on-climate-change-adaptation">Existing Initiatives and Projects on Climate Change Adaptation</h3>
<p>INSERT TABLE HERE</p>
<h3 id="lessons-from-sao-tome-and-principes-napa-process">Lessons From Sao Tome and Principe’s NAPA process</h3>
<p>On account of the United Nations Framework Convention on Climate Change’s (UNFCCC) Clean Development Mechanism (CDM), Sao Tome and Principe is a constituent of a
group of countries that are categorized as carbon sinks, yet one that is particularly affected not only by climate change but also by the costs of adaptation and
mitigation required to address it. All things considered, there is also a lack of appropriate adaptation solutions to address climate change in the country.</p>
<p>Sao Tome and Principe’s NAPA narrowly focuses its efforts on assessing the country’s adaptation priorities. In this way, it seeks to: (1) develop and implement
projects based on vulnerability to current and future impacts of climate change; (2) protect human life and ensure wellbeing, protect infrastructure and
safeguard the environment; (3) integrate adaptation measures into national policies across all relevant sectors; and (4) increase knowledge of the impacts of
climate change and of local and national level adaptation activities.</p>
<p>Barriers to the implementation of the NAPA include limited capacity with regards to technical and institutional capacity within government institutions;
insufficient information and knowledge on climate trends, climate impacts and adaptation options; and limited consideration of climate change in the policies,
strategies and plans governing sectoral and national development5. An evaluation of the institutional landscape within the country’s public administration
indicates four key weaknesses that should be appropriately addressed, these include the lack of: political decision-making; organizational capacity and
management; qualified human resources; and material and financial resources.</p>
<p>In an effort to prioritize adaptation options, the NAPA selected projects through a multi-criteria analysis. The identification of criteria for climate
vulnerable sectors was grounded on Sao Tome and Principe’s national priorities, including the specific and urgent needs of the population, poverty reduction with
a focus on women and most vulnerable groups, in addition to the costs of adaptation options. The Saotomean government through the Ministry of Public Works,
Infrastructure, Natural Resources and Environment (MPWINRE), is responsible for the implementation of the NAPA and the adoption of recommendations contained
within. The demonstration of a stakeholder approach is clear. The goal of the latest version of the NAPA is to create a list of priority adaptation options
guided by local knowledge and the experience of communities. In its implementation however, the INDC and NAPA combined, call for international support programs
on account of limited financial resources to address or minimize the adverse effects of climate change.</p>
<h3 id="coherence-with-the-national-development-context-sdgs-sfdrr-and-other-relevant-frameworks">Coherence with the National Development Context, SDGs, SFDRR and Other Relevant Frameworks</h3>
<p>Consistent with the Third National Communication, there is an apparent lack of integration of climate change considerations embedded into broader national
systems governing sectoral and national development in Sao Tome and Principe. Effective training tools and coherent cross-sectoral strategies and polices guided
by a comprehensive institutional framework is needed to respond to the issue of climate change within national development policies. Certainly, climate change is
a concern for the Saotomean population and a tremendous challenge for policy makers and decision-makers alike. Hence, a well-coordinated fully transparent
approach is crucial for effective integration of climate change adaptation into existing governance, decision-making and institutional frameworks.</p>
<h4 id="national-development-framework">National Development Framework</h4>
<p>The government has crafted a policy framework to address medium- and long-term priorities that foster poverty reduction and sustainable economic growth. Sao Tome
and Principe’s transformation agenda built on the Vision 2030 “the country we want”, spotlights the post-2015 national development priorities grounded on four
key areas, which comprise: (1) good governance for a strong democracy, (2) sustainable economic growth, (3) human development, and (4) cross-cutting issues such
as behaviors and values. The 2nd Poverty Reduction Strategic Paper (PRSP) 2012-2016 closely mirrors the thematic priorities highlighted in the Vision 2030,
although it covers a medium-term outlook. The Plan of Priority Action (PPA) 2013-2016, developed by the Ministry of Finance, Commerce and Blue Economy supports
the implementation of the PRSP, per a dedicated budget and creates an enabling environment aimed at resource mobilization. The intended successor of the 2nd PSRP
is the National Development Plan (NDP) 2017-2021.</p>
<p>The NDP is built on five strategic objectives, which aim to:
- Improve the exploitation of the country’s potential and strengthen its integration into the global economy, to achieve accelerated and sustainable economic growth, employment and poverty reduction</p>
<ul>
<li><p>Accelerate and deepen various reforms to significantly improve the human development index of Sao Tome and make substantial progress towards achieving the SDGs by 2030</p></li>
<li><p>Improve strategic management capacity for national development, strengthen good governance and democracy</p></li>
<li><p>Develop infrastructure for energy, transport, water and sanitation, and promote the development of telecommunications and ICTs, to reduce the costs of production, improve living conditions of the population and explore the opportunities offered by the public-private partnership.</p></li>
<li><p>Improve land management and preservation of the environment</p></li>
</ul>
<h4 id="unfccc-kyoto-protocol-paris-agreement">UNFCCC | Kyoto Protocol | Paris Agreement</h4>
<p>Sao Tome and Principe demonstrated its firm commitment to tackling climate change by signing the United Nations Framework Convention on Climate Change (UNFCCC)
in 1992, later ratified in 1999. The country is committed to the Convention and partakes in the Conference of the Parties (COP) meetings that convene every year
to assess the effects of the measures taken and the progress made in achieving the central objective of the Convention. The process undertaken by Sao Tome and
Principe has resulted in studies, national emission inventories, projects and appropriate adaptation actions that address the harmful effects of climate change.
The country was also a signatory to the Kyoto Protocol in 1997, which was ratified in 2008. In 2015, Sao Tome and Principe signed the Paris Agreement, conveying
its continued commitment to dealing with climate change and its impacts.</p>
<h4 id="national-communication">National Communication</h4>
<p>The Second National Communication identifies a number of challenges to effective and coordinated adaptation planning, these include: (1) lack of adequate
technical expertise at the level of national consultants; (2) absence of institutions that deal with climate change issues; (3) low disclosure of climate change
information; (4) low institutional ownership of studies on climate change; and (5) low political interest in climate change issues. By and large, climate change
issues are not integrated into national development priorities and lack the necessary institutional arrangements to support the development of National
Communications. Specifically, Sao Tome and Principe needs a National Program that facilitates the integration of climate change considerations into national
development plans and policies. The exception being that of primary, secondary and higher education level initiatives, which aim at integrating climate change
considerations into curricula and teachers’ pedagogical trainings. The follow up to the Second National Communications - the Third National Communication - has
contributed to increasing awareness of national actors responsible for advancing climate change issues and its integration into national development policies.
National planning authorities further expect to implement an ambitious and comprehensive reform agenda mentioned in part in the 2017-2022 National Development
Plan, which builds on the ENRP-II.</p>
<h4 id="the-2030-agenda-and-its-sdgs">The 2030 Agenda and its SDGs</h4>
<p>In the MDG era, Sao Tome and Principe achieved a number of MDG targets. On Goal 2: <em>Achieve universal primary education</em>, primary-school enrolment has shown an
upward trend, reaching 98% in 2016. With respect to Goal 4: <em>Reduce child mortality</em>, infant mortality dropped to 36 per 1000 live births in 2016, from 38 per 1000 in 2014. In terms of Goal 5: <em>Improve maternal health</em>, maternal mortality declined to 56 per 100 000 mothers in 2016, from 76 per 100 000 in 2015. Whereas, the implementation of the Sustainable Development Goals (SDGs) poses a pressing challenge for the country due to the ambitious nature of the global goals. For this reason, Sao Tome and Principe has prioritized 6 SDGs for implementation, which comprise:
- SDG 1: End poverty in all its forms, everywhere</p>
<ul>
<li><p>SDG 8: Promote sustained, inclusive and sustainable economic growth, full and productive employment and decent work for all</p></li>
<li><p>SDG 9: Build resilient infrastructures, promote inclusive and sustainable industrialization and foster innovation</p></li>
<li><p>SDG 13: Take urgent action to combat climate change and its impacts</p></li>
<li><p>SGD 15: Protect, restore and promote sustainable use of terrestrial ecosystems, sustainably manage forests, combat desertification, and halt and reverse land degradation and halt biodiversity loss</p></li>
<li><p>SDG 16: Promote peaceful and inclusive societies for sustainable development, provide access to justice for all, and build effective, accountable and inclusive institutions at all levels</p></li>
</ul>
<h4 id="sendai-framework-for-disaster-risk-reduction-sfdrr">Sendai Framework for Disaster Risk Reduction (SFDRR)</h4>
<p>Sao Tome and Principe signed both the Hyogo Framework for Action (HFA) 2005-2015 and its successor, the Sendai Framework for Disaster Risk Reduction (SFDRR)
2015-2030. Through the interim phase of the Sendai Framework, the government led by the National Disaster Preparedness and Response Council (CONPREC) undertook
an assessment of the national capacity to reduce the risk of disasters. The study highlighted the need to strengthen national coordination for disaster risk
reduction along with disaster prevention, risk mitigation, preparedness, response, recovery and reconstruction6. On account of the assessment, the Saotomean
government further identified capacity needs and called for the establishment of a legal framework. Despite alignment with the Sendai Framework, the country
lacks a national platform for disaster risk reduction that would serve as a coordination mechanism in the implementation, monitoring and review of the Sendai
Framework to measure national level progress and reinforce effective coordination at all levels. National platforms for disaster risk reduction built through a
nationally owned and led participatory process are multi-sectoral and interdisciplinary in nature and foster a multi-stakeholder composition in order to be
effective and sustainable.</p>
<p>Challenges in the establishment of a legal and policy framework for climate change:</p>
<p>While the country has increasingly prioritized the integration of climate change adaptation in the broader development framework, there are still a number of challenges that exist in the establishment of a legal and policy framework for climate change, these include:</p>
<ul>
<li><p>The lack of understanding among various governmental and non-governmental stakeholders about climate change impacts, vulnerability characteristics as well as available adaptation options and their effects on the population</p></li>
<li><p>Limited consideration of climate change and adaptation options into policies, strategies, plans and programmes especially at sectoral and local levels</p></li>
<li><p>Lack of a comprehensive institutional framework in place at this time that supports a coordinated and cross-sectoral approach to climate change adaptation in the country</p></li>
<li><p>Absence of a national investment plan to guide, coordinate and monitor climate change adaption investments that originate from dispersed projects</p></li>
<li><p>Limited institutional, technical and financial capacity in the country to implement, monitor and maintain adaptation interventions</p></li>
</ul>
<h2 id="approach-and-methodologies">Approach and Methodologies</h2>
<p>xxxx</p>
<h2 id="national-context">National Context</h2>
<p>xxx</p>
<h2 id="vision-goals-and-objectives-of-the-nap">Vision, Goals and Objectives of the NAP</h2>
<p>xxxx</p>
<h2 id="climate-change-adaptation-assessment">Climate Change Adaptation Assessment</h2>
<p>The principal objective of the climate change adaptation assessment of key systems is to identify and assess key vulnerabilities, hazards and risks for the country
and provide analysis on emerging trends and future climate scenarios. A key outcome of the assessment is the promotion of priority adaptation actions, projects and
programs that respond to the current and future impacts of climate change on natural and human systems, taking into consideration the specific needs of local
communities and vulnerable groups. Each of the mega systems identified, center on key areas critical to the advancement of Sao Tome and Principe’s sustainable
development pathway</p>
<p>The climate system in Sao Tome and Principe is influenced by the annual migration and dynamics of the Inter Tropical Convergence Zone (ITCZ). The climate is
characterized as complex on the basis of it being a small archipelago endowed with a unique orography. Air temperature and rainfall data are only available at five
meteorological stations, four stations are situated in Sao Tome and one in Principe. In effect, only the Sao Tome Airport weather station can detect climate change
due to its longer time series data compared to other meteorological stations across the island with data series of less than a decade.</p>
<p>The Representative Concentration Pathways (RCPs), which involve four different 21st century pathways of GHG emissions and atmospheric concentrations, air pollutant
emissions and land use8, were used to project their effects on key climate-related systems. The RCPs help project the impacts under various climate scenarios and
are useful for the country’s climate change adaptation assessment. The RCP scenarios detailed in this NAP, which include the intermediate scenario (RCP4.5) and the
very high GHG emissions scenario (RCP8.5), are compared to the baseline scenario which represents a pathway without additional efforts to constrain emissions.</p>
<h3 id="exposure-to-climate-impacts-and-risks">Exposure to Climate Impacts and Risks</h3>
<h4 id="current-climate-baseline">Current Climate (Baseline):</h4>
<p>Sao Tome and Principe is among 13 countries uniquely situated along the equator. Its characterized by a humid tropical climate with two seasons: a shorter dry
season (gravana), which lasts approximately three months from June to August and a longer rainy season that extends to nine months from September to May. The
seasons are influenced by the location of the Inter-Tropical Convergence Zone (ITCZ), which significantly affects rainfall in many equatorial countries. Longer term
shifts in the ITCZ can lead to extreme droughts or flooding in neighboring regions. The ITCZ migrates from the southern hemisphere to the North, causing the peak of
the rainy season to occur on average from February to May and then again from October to December when the ITCZ migrates back south. The period of roughly two
months between December and January, referred to as Gravanito, experiences a slight reduction in rainfall.</p>
<p>Given the characteristics of the archipelago, Sao Tome and Principe has an average surface temperature of 25.6° C and high levels of humidity that can reach over
90% at higher altitudes. The country has many microclimates predominately as a function of rainfall, temperature and topographical relief. It therefore follows
that temperatures drop as altitude increases. This is the case for Pico de Sao Tome which sits at an elevation of 2024m in the central west part of the island
and Pico de Principe at an altitude of 948m in the southern region. The country’s orographic precipitation is determined by the volcanic massifs that result in
rainfall gradients, which offer significant water potential. Average annual rainfall is 2000-3000 mm/year. The highest annual average rainfall of 7000mm is
recorded in the southwest region of the island of Sao Tome (Quijá and Xufe-xufe river basins), which is home to dense tropical forests. The savanna is located in
the northeastern parts of the island, where rainfall is measured at an annual average of below 1000mm. Parts of the northern regions of the island, namely the
districts of Água Grande and Lobata, experience an average monthly rainfall of below 50mm during gravana. There are marked complexities of engaging in
horticulture without irrigation, particularly in light of the fact that the highest population densities are situated in these regions.</p>
<p>Both the island of Sao Tome and the island of Principe are dealing with the impacts of climate change and extreme weather events. The country continues to be
impacted by natural hazards, which include coastal and river flash floods, storms and droughts. Frequent flash floods and severe storms occur with high
incidences of hail, lightening and strong winds that threaten the country. The sectors most affected by very frequent events are the services and agriculture
sectors, which are impacted less than once every decade10. Under the current climate, 23 000 people on average, representing 12% of the total population in 2016,
are annually affected by droughts and affected livestock (i.e., animals living in areas hit by droughts) represent 14% of the total livestock. Beyond this, under
both present and future climates, physical crop losses are centered around four crops (banana, coconut, oil palm and taro).</p>
<h4 id="emerging-climate-trends">Emerging Climate Trends:</h4>
<p>Warming of temperatures and reductions in rainfall are of paramount importance to Saotomeans as this can decrease the river flow and influence the availability
of subterranean water. In certain regions of Sao Tome and Principe climate impacts such as sea-level rise, flooding and coastal erosion have been observed at
levels that risk damage and destruction to major infrastructure. According to the baseline, RCP4.5 and RCP8.5 scenarios, the annual average temperature trend
reported by Sao Tome Airport’s weather station, indicated an increase of 0.6 °C between 1960 and 2016, representing an average warming of around 0.01 °C per
year. The warming comes into effect from the months of October until May. The highest annual average temperature of 26.2 °C was recorded in 1998, whereas the
lowest annual average temperature of 24.7 °C was recorded in 1964. This demonstrates an increase in interannual variability of the climate in Sao Tome and
Principe. Notably, the five warmest years to-date have occurred in the last 20 years, which further indicates an increasing trend of warming of annual average
temperatures. Parallel to other countries in West Africa, temperature observations in Sao Tome and Principe reveal an increasing trend. The figures below, based
on climate analysis from 1970 to 2015, demonstrate an average increase in temperature. Trends in average annual precipitation, however, are not clearly defined
and are variable in time and space.</p>
<p>INSERT IMAGES HERE</p>
<h4 id="future-climate-scenarios-projected-future-climate">Future Climate Scenarios: Projected Future Climate</h4>
<p>A climate-based study on Sao Tome and Principe detailed in the Third National Communication, observed changes in total rainfall during the rainy season and dry
season for the 2041–2070 period. In the RCP4.5 scenario, rainfall projections predict a rainier climate from October to May (rainy season) and normal to dry
conditions from June to September (dry season). In the RCP8.5 scenario, projections indicate a reduction in rainfall for both rainy and dry periods, with the
exception of December and January based on a monthly analysis, which demonstrates an increase in rainfall on the island of Sao Tome. This stands in contrast to
the country’s gravanito period under the baseline scenario where rainfall typically decreases in the months of December and January. In terms of climate
extremes, projections show a surge in total annual rainfall under RCP4.5 and an increase in rainfall intensity under both scenarios, particularly in the Caué and
Lembá districts in the southwestern region of the island of Sao Tome. Further to this, there is a rise in the number of consecutive dry days that signals a
prolonged dry season (gravana) and uneven temporal distribution of rainfall in the region. With respect to extreme temperature, climate projections under both scenarios (RCP4.5 and RCP8.5) indicate warming, with a surge in heat waves on hot days and an increase in annual minimum temperatures.</p>
<p>INSERT IMAGES HERE</p>
<p>Under future climate conditions and with the inclusion of socio-economic projections, GDP impacted by droughts (i.e., the economic value produced in areas hit by
droughts) could rise to USD $600 million13. The number of affected livestock is projected to marginally decline relative to current climate conditions. The
agricultural production losses owing to droughts are projected to drop under future climate conditions for all six crops of banana, coconut, cocoa, fruits, palm
oil and taro. Under future climate conditions, the agricultural loss decreases in both islands. Moreover, sea level is projected to rise by 0.13- 0.56 meters by
2090 compared to average levels over the 1980-1999 period14. Fishermen will be increasingly exposed to climate variability and will continue to be affected by
the diminution of marine resources due to disruptions to coastal ecosystems, destruction of mangroves and increases in storms and other natural hazards.</p>
<h4 id="regional-projections">Regional Projections:</h4>
<p>As it concerns regional projections, under RCP4.5, global models predict an increase in rainfall in West Africa between the months of October to March. There is
a variation in rainfall of about 10% to 20% over the 1986-2005 reference period. The climate models for the periods 2016–2035, 2046–2065, and 2081–2100 indicate
that changes in temperature are consistent across the models. In the middle of the 21st century, specifically for the years 2046–2065, the average temperature
increase ranges from 1° to 2°C in the Gulf of Guinea. A slight increase in average rainfall for the period 2036–2065 is observed, particularly from May to
September during gravana in the Gulf of Guinea, including the islands of Sao Tome and Principe.</p>
<p>INSERT IMAGES HERE</p>
<h4 id="local-projections">Local Projections:</h4>
<p>Local climate change projections for the 2041–2070 period is based on the 1971–2000 period, for which projections indicate warming of temperatures in the study
belt, principally from October to May. During gravana warming is more pronounced in the central region of Sao Tome, where the altitude is highest. All in all,
warming trends under both RCP4.5 and RCP8.5 is comparable, with an increase in intensity of warming in the RCP8.5 scenario. The local projections estimated for
both islands on the basis of the ETA model, predict an increase in temperature of approximately 2.5 °C under RCP4.5 and 3°C in RCP8.5 in both rainy and dry
periods. For both the rainy season and dry season under both scenarios, local scale projections do not demonstrate changes in annual temperature across the
islands of Sao Tome and Principe.</p>
<h3 id="assessment-by-key-systems">Assessment by Key Systems</h3>
<h4 id="agriculture">Agriculture</h4>
<p>The agriculture sector is integral to Sao Tome and Principe’s national economy and its vulnerability to climate change is captured, in part, by thermal stresses
to the environment. Considering that subsistence agriculture in the country is narrowly characterized by its fragility and poor planning techniques, it tends to
import a large portion of its food for consumption. In Sao Tome and Principe, subsistence agriculture crop production consists of taro, corn, tomato, cassava,
pineapple and breadfruit, among other crops. Its food commodity markets focus on the export trade of cocoa, coconut, coffee (Robusta and Arabica), flowers,
vanilla, chili pepper and palm oil. On the whole, the agriculture sector employs 60% of the labor force but represents only 22.4% of GDP16. With respect to food
security and access, 10% of households have low food consumption and 12.6% of households have limited food consumption.</p>
<h5 id="priority-area-cocoa-theobroma-cacao-l.-production">Priority Area: Cocoa (Theobroma cacao L.) Production</h5>
<p>At the turn of the century, Sao Tome and Principe was one of the global leaders in the production of cocoa beans. Among myriad factors, the tropical climate,
heavy rainfall, and the fertile volcanic soils gave rise to the rapid development of cocoa plantations called roças. Sao Tome and Principe’s cocoa is recognized
for its superior quality and a burgeoning organic cocoa sector. Cocoa production constitutes a main share of the agriculture sector, accounting for roughly 17%
of the Gross Domestic Product (GDP)17 as the main export commodity produced on plantations. Following the progressive redistribution of sizeable cocoa
plantations at the outset of the 1990s, small farmers assumed responsibility of a majority of cocoa production as colonial plantations were nationalized. Cocoa
farmers supplemented their income by producing additional crops such as vegetables, fruits, vanilla and pepper for trade. As a consequence of the 1998
international cocoa price crash, producers realized that cocoa production would not secure their livelihoods. Studies later suggested that combining organic
cocoa production and fair-trade principles would improve farmers income. Notwithstanding the substantial contribution of cocoa to the domestic economy, its
export share now comprises a negligible share of the global cocoa market.</p>
<h5 id="vulnerability-of-the-agriculture-sector">Vulnerability of the Agriculture Sector</h5>
<p>The following is a précis of key vulnerabilities affecting Sao Tome and Principe’s agricultural landscape:</p>
<ul>
<li><p>Fragile and poorly organized subsistence agriculture</p></li>
<li><p>Intensive agriculture in areas of great slope</p></li>
<li><p>Increase in temperature throughout the entire country in recent years</p></li>
<li><p>Decrease in rainfall and the subsequent reduction of river flows in the east</p></li>
<li><p>Lengthened dry seasons</p></li>
<li><p>Landslides due to torrential rains (particularly on mountain slopes)</p></li>
<li><p>Lack of good handling practices and zootechnical/agroforestry management</p></li>
<li><p>Absence of animal and plant species that are adapted to extreme weather conditions i.e., drought and desertification</p></li>
<li><p>Lack of environmental education among the population</p></li>
</ul>
<h5 id="exposure-to-climate-impacts-and-risks-1">Exposure to Climate Impacts and Risks</h5>
<p>In the agriculture subsector, greenhouse gas (GHG) emissions originate from enteric fermentation, manure management, agricultural soils, savanna fires and
burning of agricultural wastes which in total amount to 12.5 Gg CO2eq19. Further, studies on the risk index of agricultural crops such as taro, maize, cocoa and
pepper were undertaken and reported in the Third National Communication. Projections for each crop indicated high risk to arable lands on account of the current
climate.</p>
<p>Future Climate Scenarios: Projected Impact on Cocoa</p>
<p>As concerns cocoa, Sao Tome and Principe has experienced a decline in productivity in the last decade, as cocoa bean yields fell from 1333 hg/ha in 2008 to 1014
hg/ha in 2018 (FAOSTAT, 2020). The regions in north of Lembá, west of Lobata and Mé-Zóchi are of great import in terms of the local cocoa production. Climate
change impacts such as intense tropical storms hamper production and cause destruction of the natural environment suitable for cultivating cocoa trees. Further
impacts include increased temperatures and prolonged dry seasons that trigger thermal and water stress and bring about vulnerability to pest infestation.
Protozoal diseases of cocoa trees such as Black pod disease thrive in humid climates linked to warmer temperatures. Under RCP4.5, there is moderate risk in Sao
Tome due to low productive potential of the cocoa bean and water stress. In the RCP8.5 scenario, these cocoa growing regions- specifically the regions north of
Lembá, west of Lobata and Mé-Zóchi are expected to sustain high exposure to climate risks due to water stress. The water resources sector in Sao Tome and
Principe is among the most vulnerable to climate change. In effect, the reduction of groundwater contributes to the waning of water currents causing poor
distribution of water resources to the population, with major impacts to soils critical for agricultural and agro-pastoral production. According to the
literature, other regions of the island where risk classifications increased were among the main the contributors to water stress.</p>
<p>INSERT IMAGES HERE</p>
<p>Projected Impact on Taro</p>
<p>Along with risks to cocoa, projections for taro indicate an increased risk due to thermal stress (South of the Caué district), which could increase its exposure
to taro plant disease such as taro leaf blight (TLB) (Phytophthora colocasiae). TLB which is a major disease of the taro plant is caused by a pseudo-fungus and
could threaten food security in the country. The risk assessment of the taro plant has resulted in a moderate to very high-risk rating in most regions of the
island of Sao Tome.</p>
<p>Future Climate Scenarios: Projected Impact on Corn</p>
<p>With regard to corn, there is high risk to corn production along the border regions of the Caué and Lembá districts. The high risk to corn is due to exposure to
rust under RCP4.5. The rapid spread of corn rust takes place when favorable environmental conditions, for instance suitable temperatures and moisture, persist
for a protracted period throughout the growing season. Considering a RCP8.5 scenario, there would be an upsurge in risks to corn production areas classified as
very high risk, owing to an increase in thermal stress and exposure to rust diseases. In an alternative variety of corn, the risk exposure of corn production in
a number of coastal regions increased from very low to high due to corn crop’s low yield potential.</p>
<h5 id="climate-risks-in-agriculture-production">Climate Risks in Agriculture Production</h5>
<p>The following list of climate risks, stem from the interaction between natural hazards in Sao Tome and Principe and the vulnerability and exposure of agricultural communities, their livestock and the natural systems within which they operate.</p>
<ul>
<li><p>Existing planting areas could be reduced due to the change in edaphoclimatic conditions leading to a decrease in agriculture production</p></li>
<li><p>Heavy rainfall that can cause flooding, resulting in loss of microelements and nutrients in soil, critical for agriculture and grazing</p></li>
<li><p>Phyto-pathogenic microorganisms such as fungi, bacteria and viruses that when exposed to conditions of precipitation and increase in temperature, become more reproductive and proliferate</p></li>
<li><p>The warming of temperature in extremes, triggering the proliferation of parasites (carapatas) and affecting the metabolism of animals especially during the productive cycles of pastures, which could lead to a reduction in crop yields and animal numbers</p></li>
<li><p>Reduction in productive agriculture leading to reduced farmers’ income</p></li>
</ul>
<h5 id="adaptation-options">Adaptation Options</h5>
<p>The diversity of climate change impacts and adaptation options coupled with the complexity of adaptation process demonstrate the unrealistic assumption of perfect adaptation by individual farmers20. Still, promising adaptation measures to smooth out fluctuations in agriculture yields (and indirectly social welfare), include:</p>
<ul>
<li><p>Examination into and enhancement of cultural practices to reduce the impacts of water and thermal stress</p></li>
<li><p>Surveying and development of crop varieties resistant to water and thermal stress, to ensure food security</p></li>
<li><p>Offering technical advice and extension services to producers on production techniques to generate high quality yields e.g., cocoa beans</p></li>
<li><p>Provision of guidance on how to use specialized equipment and storage facilities to limit spoilage after harvest e.g., solar cocoa dryers</p></li>
<li><p>Offering technical guidance on existing regulations and legal frameworks e.g., on organic cocoa regulations</p></li>
<li><p>Development and adoption of heat-resistant cultivars</p></li>
<li><p>Enhancement of farming practices that reduce pests and crop/plant diseases</p></li>
<li><p>Implementation of a seed distribution program of climate-resilient seeds for small holders</p></li>
<li><p>Development of appropriate cultivation techniques in sloping areas and other risk zones</p></li>
</ul>
<p>-‘Floodproofing’ measures (such as elevation of living spaces)</p>
<ul>
<li><p>Adoption of climate smart agricultural techniques</p></li>
<li><p>Institution of coastal protection measures (such as seawalls, bulkheads, and revetments)</p></li>
</ul>
<h4 id="fisheries">Fisheries</h4>
<p>The fishery sector plays a critical role in Sao Tome and Principe’s national economy as it represents 3.7% of GDP. It generates employment, supports foreign
exchange and provides the populations’ nutritional needs in terms of animal protein, of which 70% is derived from fish. The jurisdictional waters of Sao Tome and
Principe, represented by the Exclusive Economic Zone (EEZ), span almost 165,000km and offer a fishing potential of 29,000 tonnes21. Sao Tome and Principe’s
continental shelf, which is very narrow, covers 5-10km and reaches depths of less than 200 meters, is reputed to house the most ergonomic fishing grounds for
artisanal fishing. Yet, marine fishery resources show a persistent and substantial decline as a consequence of overfishing and abandonment of traditional
techniques in lieu of unsustainable practices. Two decades prior, Sao Tome and Principe’s fish stock was gauged at 8500 tonnes of pelagic fish, among 185 fish
species stemming from 67 families. Most recent data from 2013 indicate that the domestic supply of demersal fish stands at 1108 tonnes, while pelagic fish and
crustaceans amount to 3073 tonnes and 15 tonnes, respectively for the same year (FAOSTAT, 2018).</p>
<p>INSERT IMAGES HERE</p>
<p>The fishery sector is among the most vulnerable to climate change and is further threatened by a hostile environment, notably the lack of large estuaries, which
could sustain a variety of marine species and an absence of coastal upwelling that could give rise to rich nutrients that nourish the surface water and improve
its biological productivity. As shown in Figure 3, small scale fishing and semi-industrial fishing contribute to the fishery sector, whereas industrial fishing
is taken up by foreign vessels in Saotomean waters by way of bilateral fishing agreements. Unsustainable fishing techniques are diminishing fish resources at a
faster rate than can be replenished. Artisanal fishing comprises a quarter of the country’s workforce, signaling the importance of the sector in terms of social
and economic development outcomes. While both men and women are active in the fishery sector, men’s roles are centered on fish capture and harvest, while women
focus, by and large, on bringing the fish to secondary wholesale markets. 3,051 artisanal fishermen work at 44 landing sites across the islands, 29 landing sites
are situated on the island of Sao Tome and 15 on the island of Principe.</p>
<h5 id="priority-area-fish-conservation">Priority Area: Fish Conservation</h5>
<p>The conservation of coastal and marine biological diversity, particularly the conservation of fisheries, is critical to the ecological balance of the marine
system, the social well-being of the population and the economic growth potential of the country. Rapid population growth is putting downward pressure on natural
resources including fish stocks with predicted effects on biodiversity24, calling into question the sustainability of the fishery sector. Causative to the
decrease in fishing stocks is the use of unsustainable fishing techniques such as bay area fishing, use of dynamite and fine-meshed nets. At present, the
unregulated exploitation of halieutic resources coupled with poor monitoring and surveillance capacities, limited knowledge of the configuration of national
fisheries resources, and the anemic application of the 2001 Law of Fisheries (Law No. 9/2001) and the 2010-2025 Fisheries Plan, directly contribute to the steady
depletion of fish resources off the coast of Sao Tome and Principe. This reduction of fish resources in turn reduces the income of fishermen including fish
traders and engenders poverty among coastal inhabitants.</p>
<p>According to the objectives of the 2015-2020 National Strategy Plan for Biological Diversity, local conservation actions could include:</p>
<ul>
<li><p>Construction of a protected marine area on both islands in which fish stocks are monitored and provided the opportunity to mature and procreate</p></li>
<li><p>Spatial ordering and sustainable management of Sao Tome and Principe’s EEZ</p></li>
<li><p>Sensitization of coastal populations to means of conservation</p></li>
<li><p>Monitoring of actions to protect and conserve coastal areas</p></li>
<li><p>Strengthening of inter-sectorial actions of various government institutions in the field of conservation and sustainable management</p></li>
<li><p>Establishment of an action plan to ensure oversight</p></li>
<li><p>Improving the monitoring and inspection of actions under the legal framework for fisheries</p></li>
</ul>
<h5 id="vulnerability-of-the-fishery-sector">Vulnerability of the Fishery Sector</h5>
<p>On the basis of views and perceptions of local communities’, key vulnerabilities of the fishery sector were identified through the NAPA as well as the Convention
on Biological Diversity (CBD) Sixth National Report. Sea level rise and lighting strikes were among the climate change impacts cited, which affect vulnerable
groups such as artisanal fishermen and their families, rural inhabitants and farmers. Artisanal fishermen to date employ age-old fishing techniques. Due to the
limited fish supply in their immediate vicinity, fishermen are routinely forced to travel the distance in pursuit of fish25. As it happens, fishermen often
vanish at sea or experience damage or destruction to their fishing gear and vessels due to extreme weather events, such as strong winds, fog and turbulence at
sea. Squalls have wreaked havoc on fishing activities and caused rivers to flood, which has brought about hardships to fishing families. The land, boat moorings
and beaches have also been impacted by coastal erosion. Sedimentation of river water during the rainy season has obstructed reproduction areas and growth zones
critical to the proliferation of several demersal species and a number of pelagic species.</p>
<p>INSERT IMAGES HERE</p>
<p>Main vulnerabilities:</p>
<ul>
<li><p>Loss of materials and artisanal fishing equipment during fishing</p></li>
<li><p>Loss of life due to disappearance at sea</p></li>
<li><p>Partial or complete destruction of vessels at docks or beaches</p></li>
<li><p>Damage to fishermen’s dwellings on account of sea water intrusion</p></li>
<li><p>An upsurge in the level of poverty among women due to loss of fishing equipment, livelihoods and lives of (fishermen) spouses</p></li>
<li><p>Increase in the number of school-age children that drop out of school in order to economically contribute to the household through fishing</p></li>
<li><p>Overexploitation of resources as a result of poor sectorial management</p></li>
<li><p>Use of timeworn and unsafe vessels, and inadequate equipment e.g., the vessel fleets are mostly composed of single-person, wooden, non-motorized, small-capacity boats</p></li>
<li><p>Weak infrastructure and poor governance</p></li>
<li><p>Poor health and sanitation</p></li>
</ul>
<h5 id="exposure-to-climate-impacts-and-risks-2">Exposure to Climate Impacts and Risks</h5>
<p>Humid wind currents, prevailing in the southwest regions, are intercepted by the Sao Tome and Principe’s topological relief. Strong winds and storms have
historically affected Saotomeans. Particularly in 2001, 301 people were affected in the agricultural community in Santa Catarina and later in 2009, 43 people
were affected in Roça Santa Cecília. Recent climate-related disasters have been a result of the rain and wind regime. With respect to natural hazards, the
potential increase in fog has been attributed to changes in the wind.</p>
<p>Future Climate Scenarios: Projected Impact on the Fishery Sector</p>
<p>On account of determining climate risks, wind speed indexes (mean, maximum and annual minimum values) were established under the climate-based study detailed in
the Third National Communication. The wind speed indexes, which are based on projected changes in surface wind extremes indicate a tendency towards a reduction
across all values of wind in future scenarios, under both RCP4.5 and RCP 8.5. There is a trend in the reduction of daily maximum winds that suggests a weakening
of wind events under future climate projections26. Still, there are numerous accounts on the effects of strong winds that trigger waves that cause damage to
infrastructure and loss of life of fishermen. Expressly, the artisanal fishery sector has witnessed an increase in the number of days with strong winds and
maritime turbulence27. As a consequence, storms have contributed to the loss of life, in addition to fishermen who disappear on the high seas due to heavy fog.
This impact is further experienced by communities in Neves, Pantufo and Praia Melão, where there is a high incidence of trolling and every 1 in 20 families is
left orphaned or widowed. By and large, losses peak in February during the gravanito period (the foggy season), which are later registered in March as search and
rescue efforts continue for nearly one month following the actual event.</p>
<p>What is more, an increase in the predicted temperature of 2.5 °C for the 2040-2060 period will likely cause turbulences in sea currents due to the crossing of
cold currents in Benguela and warm currents in the Gulf of Guinea, which would cause an upwelling. The rise in sea temperature is expected to cause fish to
migrate towards the poles towards deeper and colder waters. On account of a reduction in the quantity of halieutic resources, fishermen would have to travel
father out to sea and attempt to reach 60 meters in depth to access fish. In some instances, it is reported that small-scale fishermen travel up to 40 miles from
the shore and reach fishing ground depths between 100 and 250 meters28. As aforementioned, reduction in fish catch is also attributable to the overexploitation
of fishing resources and the use of unsustainable practices. In order to ensure the survival of the artisanal fishery sector, changes in current techniques are
required to adapt to climate change. Sao Tome and Principe’s NDC reveals that a 50% loss in artisanal fisheries production is forecasted as a result of climate
change.</p>
<p>INSERT IMAGES HERE</p>
<h5 id="adaptation-options-1">Adaptation Options</h5>
<p>Fish conservation and preservation:</p>
<ul>
<li><p>Investment in small-infrastructures and facilities for fishing communities e.g., cold storage, ice-machine and landing sites, with proper management systems to ensure their sustainable use</p></li>
<li><p>Construction of conservation facilities for fish</p></li>
<li><p>Means for reducing post-harvest losses in fisheries</p></li>
<li><p>Means of preservation that will extend the storage life without substantially altering the nature of the raw material</p></li>
<li><p>Selective fishing gear that avoids the capture, retention, and subsequent discarding of immature fish and unwanted species</p></li>
<li><p>Systems to locate abandoned, lost, or otherwise discarded fishing gear (ALDFG) which continues to catch fish (causing unintentional mortality), resulting in “ghost fishing”</p></li>
<li><p>Proper on-board handling of fish, for example ensuring fish are chilled and good hygiene conditions prevail to avoid cross contamination, as well as ensuring the physical integrity of fish to avoid bruising and damage to fish flesh and accelerated spoilage</p></li>
</ul>
<p>Fishing safety and improvements to infrastructure:</p>
<ul>
<li><p>Investment in suitable fishing vessels, gear and protocols to ensure safety of fishermen</p></li>
<li><p>Investment in trainings for fishermen on new technologies that help assess climate risks</p></li>
<li><p>Delimitation of fishing zones with solar signaling buoys</p></li>
<li><p>Implementation of an alert system for deep sea fishing navigation</p></li>
<li><p>Construction and installation of Fish Aggregating Device (FAD) in coastal areas</p></li>
<li><p>Distribution of portable navigation tools and rescue equipment (e.g., GPS, compasses and lifejackets) and installation of communication and rescue systems</p></li>
<li><p>Construction of coastal defense mechanisms in affected areas</p></li>
<li><p>Construction of quality floating docks at points of embarkation and disembarkation</p></li>
</ul>
<p>Bilateral fishing agreements and good governance:</p>
<ul>
<li><p>Review of fishing and private license agreements in order for Sao Tome and Principe to tap into benefits of marine resources within its jurisdictional waters</p></li>
<li><p>Address management challenges of maritime sectors and develop a Blue Economy through the use of Marine Spatial Planning (MSP)</p></li>
</ul>
<h2 id="national-adaptation-priorities">National Adaptation Priorities</h2>
<p>xxxx
xxxx</p>
<h2 id="implementation-strategy-for-the-nap">Implementation Strategy for the NAP</h2>
<p>xxx</p>
<h2 id="alignment-with-the-gcf-country-programme">Alignment with the GCF Country Programme</h2>
<p>xxx</p>
<h2 id="mobilization-of-other-sources-of-finance">Mobilization of other Sources of Finance</h2>
<p>xxx</p>
<h2 id="monitoring-and-evaluation-of-adaptation-actions-and-process">Monitoring and evaluation of adaptation actions and process</h2>
<p>xxx</p>
<h2 id="reporting">Reporting</h2>
<p>xxx</p>
<h2 id="further-development-of-the-programme-to-support-future-naps">Further development of the programme to support future NAPs</h2>
<p>xxx</p>
<h2 id="annex-i-nap-outputs">Annex I: NAP Outputs</h2>
<p>xxx</p>
<h2 id="annex-2-country-profile">Annex 2: Country Profile</h2>
<p>xxxx</p>
<h2 id="annex-3-data-and-information-system-to-support-the-nap">Annex 3: Data and information system to support the NAP</h2>
<p>xxx</p>
<h2 class="page_break_before" id="references">References</h2>
<!-- Explicitly insert bibliography here -->
<div id="refs" role="doc-bibliography">

</div>
<!-- default theme -->

<style>
  /* import google fonts */
  @import url("https://fonts.googleapis.com/css?family=Open+Sans:400,600,700");
  @import url("https://fonts.googleapis.com/css?family=Source+Code+Pro");

  /* -------------------------------------------------- */
  /* global */
  /* -------------------------------------------------- */

  /* all elements */
  * {
    /* force sans-serif font unless specified otherwise */
    font-family: "Open Sans", "Helvetica", sans-serif;

    /* prevent text inflation on some mobile browsers */
    -webkit-text-size-adjust: none !important;
    -moz-text-size-adjust: none !important;
    -o-text-size-adjust: none !important;
    text-size-adjust: none !important;
  }

  @media only screen {
    /* "page" element */
    body {
      position: relative;
      box-sizing: border-box;
      font-size: 12pt;
      line-height: 1.5;
      max-width: 8.5in;
      margin: 20px auto;
      padding: 40px;
      border-radius: 5px;
      border: solid 1px #bdbdbd;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      background: #ffffff;
    }
  }

  /* when on screen < 8.5in wide */
  @media only screen and (max-width: 8.5in) {
    /* "page" element */
    body {
      padding: 20px;
      margin: 0;
      border-radius: 0;
      border: none;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05) inset;
      background: none;
    }
  }

  /* -------------------------------------------------- */
  /* headings */
  /* -------------------------------------------------- */

  /* all headings */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    margin: 20px 0;
    padding: 0;
    font-weight: bold;
  }

  /* biggest heading */
  h1 {
    margin: 40px 0;
    text-align: center;
  }

  /* second biggest heading */
  h2 {
    margin-top: 30px;
    padding-bottom: 5px;
    border-bottom: solid 1px #bdbdbd;
  }

  /* heading font sizes */
  h1 {
    font-size: 2em;
  }
  h2 {
    font-size: 1.5em;
  }
  h3 {
    font-size: 1.35em;
  }
  h4 {
    font-size: 1.25em;
  }
  h5 {
    font-size: 1.15em;
  }
  h6 {
    font-size: 1em;
  }

  /* -------------------------------------------------- */
  /* manuscript header */
  /* -------------------------------------------------- */

  /* manuscript title */
  header > h1 {
    margin: 0;
  }

  /* manuscript title caption text (ie "automatically generated on") */
  header + p {
    text-align: center;
    margin-top: 10px;
  }

  /* -------------------------------------------------- */
  /* text elements */
  /* -------------------------------------------------- */

  /* links */
  a {
    color: #2196f3;
    overflow-wrap: break-word;
  }

  /* superscripts and subscripts */
  sub,
  sup {
    /* prevent from affecting line height */
    line-height: 0;
  }

  /* unordered and ordered lists*/
  ul,
  ol {
    padding-left: 20px;
  }

  /* class for styling text semibold */
  .semibold {
    font-weight: 600;
  }

  /* class for styling elements horizontally left aligned */
  .left {
    display: block;
    text-align: left;
    margin-left: auto;
    margin-right: 0;
    justify-content: left;
  }

  /* class for styling elements horizontally centered */
  .center {
    display: block;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
    justify-content: center;
  }

  /* class for styling elements horizontally right aligned */
  .right {
    display: block;
    text-align: right;
    margin-left: 0;
    margin-right: auto;
    justify-content: right;
  }

  /* -------------------------------------------------- */
  /* section elements */
  /* -------------------------------------------------- */

  /* horizontal divider line */
  hr {
    border: none;
    height: 1px;
    background: #bdbdbd;
  }

  /* paragraphs, horizontal dividers, figures, tables, code */
  p,
  hr,
  figure,
  table,
  pre {
    /* treat all as "paragraphs", with consistent vertical margins */
    margin-top: 20px;
    margin-bottom: 20px;
  }

  /* -------------------------------------------------- */
  /* figures */
  /* -------------------------------------------------- */

  /* figure */
  figure {
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
  }

  /* figure caption */
  figcaption {
    padding: 0;
    padding-top: 10px;
  }

  /* figure image element */
  figure > img,
  figure > svg {
    max-width: 100%;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  /* figure auto-number */
  img + figcaption > span:first-of-type,
  svg + figcaption > span:first-of-type {
    font-weight: bold;
    margin-right: 5px;
  }

  /* -------------------------------------------------- */
  /* tables */
  /* -------------------------------------------------- */

  /* table */
  table {
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
  }

  /* table cells */
  th,
  td {
    border: solid 1px #bdbdbd;
    padding: 10px;
    /* squash table if too wide for page by forcing line breaks */
    overflow-wrap: break-word;
    word-break: break-word;
  }

  /* header row and even rows */
  th,
  tr:nth-child(2n) {
    background-color: #fafafa;
  }

  /* odd rows */
  tr:nth-child(2n + 1) {
    background-color: #ffffff;
  }

  /* table caption */
  caption {
    text-align: left;
    padding: 0;
    padding-bottom: 10px;
  }

  /* table auto-number */
  table > caption > span:first-of-type,
  div.table_wrapper > table > caption > span:first-of-type {
    font-weight: bold;
    margin-right: 5px;
  }

  /* -------------------------------------------------- */
  /* code */
  /* -------------------------------------------------- */

  /* multi-line code block */
  pre {
    padding: 10px;
    background-color: #eeeeee;
    color: #000000;
    border-radius: 5px;
    break-inside: avoid;
    text-align: left;
  }

  /* inline code, ie code within normal text */
  :not(pre) > code {
    padding: 0 4px;
    background-color: #eeeeee;
    color: #000000;
    border-radius: 5px;
  }

  /* code text */
  /* apply all children, to reach syntax highlighting sub-elements */
  code,
  code * {
    /* force monospace font */
    font-family: "Source Code Pro", "Courier New", monospace;
  }

  /* -------------------------------------------------- */
  /* quotes */
  /* -------------------------------------------------- */

  /* quoted text */
  blockquote {
    margin: 0;
    padding: 0;
    border-left: 4px solid #bdbdbd;
    padding-left: 16px;
    break-inside: avoid;
  }

  /* -------------------------------------------------- */
  /* banners */
  /* -------------------------------------------------- */

  /* info banners */
  .banner {
    box-sizing: border-box;
    display: block;
    position: relative;
    width: 100%;
    margin-top: 20px;
    margin-bottom: 20px;
    padding: 20px;
    text-align: center;
  }

  /* paragraph in banner */
  .banner > p {
    margin: 0;
  }

  /* -------------------------------------------------- */
  /* highlight colors */
  /* -------------------------------------------------- */

  .white {
    background: #ffffff;
  }
  .lightgrey {
    background: #eeeeee;
  }
  .grey {
    background: #757575;
  }
  .darkgrey {
    background: #424242;
  }
  .black {
    background: #000000;
  }
  .lightred {
    background: #ffcdd2;
  }
  .lightyellow {
    background: #ffecb3;
  }
  .lightgreen {
    background: #dcedc8;
  }
  .lightblue {
    background: #e3f2fd;
  }
  .lightpurple {
    background: #f3e5f5;
  }
  .red {
    background: #f44336;
  }
  .orange {
    background: #ff9800;
  }
  .yellow {
    background: #ffeb3b;
  }
  .green {
    background: #4caf50;
  }
  .blue {
    background: #2196f3;
  }
  .purple {
    background: #9c27b0;
  }
  .white,
  .lightgrey,
  .lightred,
  .lightyellow,
  .lightgreen,
  .lightblue,
  .lightpurple,
  .orange,
  .yellow,
  .white a,
  .lightgrey a,
  .lightred a,
  .lightyellow a,
  .lightgreen a,
  .lightblue a,
  .lightpurple a,
  .orange a,
  .yellow a {
    color: #000000;
  }
  .grey,
  .darkgrey,
  .black,
  .red,
  .green,
  .blue,
  .purple,
  .grey a,
  .darkgrey a,
  .black a,
  .red a,
  .green a,
  .blue a,
  .purple a {
    color: #ffffff;
  }

  /* -------------------------------------------------- */
  /* buttons */
  /* -------------------------------------------------- */

  /* class for styling links like buttons */
  .button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    margin: 5px;
    padding: 10px 20px;
    font-size: 0.75em;
    font-weight: 600;
    text-transform: uppercase;
    text-decoration: none;
    letter-spacing: 1px;
    background: none;
    color: #2196f3;
    border: solid 1px #bdbdbd;
    border-radius: 5px;
  }

  /* buttons when hovered */
  .button:hover:not([disabled]),
  .icon_button:hover:not([disabled]) {
    cursor: pointer;
    background: #f5f5f5;
  }

  /* buttons when disabled */
  .button[disabled],
  .icon_button[disabled] {
    opacity: 0.35;
    pointer-events: none;
  }

  /* class for styling buttons containg only single icon */
  .icon_button {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    text-decoration: none;
    margin: 0;
    padding: 0;
    background: none;
    border-radius: 5px;
    border: none;
    width: 20px;
    height: 20px;
    min-width: 20px;
    min-height: 20px;
  }

  /* icon button inner svg image */
  .icon_button > svg {
    height: 16px;
  }

  /* -------------------------------------------------- */
  /* icons */
  /* -------------------------------------------------- */

  /* class for styling icons inline with text */
  .inline_icon {
    height: 1em;
    position: relative;
    top: 0.125em;
  }

  /* -------------------------------------------------- */
  /* print control */
  /* -------------------------------------------------- */

  @media print {
    @page {
      /* suggested printing margin */
      margin: 0.5in;
    }

    /* document and "page" elements */
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
    }

    /* "page" element */
    body {
      font-size: 11pt !important;
      line-height: 1.35;
    }

    /* all headings */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      margin: 15px 0;
    }

    /* figures and tables */
    figure,
    table {
      font-size: 0.85em;
    }

    /* table cells */
    th,
    td {
      padding: 5px;
    }

    /* shrink font awesome icons */
    i.fas,
    i.fab,
    i.far,
    i.fal {
      transform: scale(0.85);
    }

    /* decrease banner margins */
    .banner {
      margin-top: 15px;
      margin-bottom: 15px;
      padding: 15px;
    }

    /* class for centering an element vertically on its own page */
    .page_center {
      margin: auto;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      vertical-align: middle;
      break-before: page;
      break-after: page;
    }

    /* always insert a page break before the element */
    .page_break_before {
      break-before: page;
    }

    /* always insert a page break after the element */
    .page_break_after {
      break-after: page;
    }

    /* avoid page break before the element */
    .page_break_before_avoid {
      break-before: avoid;
    }

    /* avoid page break after the element */
    .page_break_after_avoid {
      break-after: avoid;
    }

    /* avoid page break inside the element */
    .page_break_inside_avoid {
      break-inside: avoid;
    }
  }

  /* -------------------------------------------------- */
  /* override pandoc css quirks */
  /* -------------------------------------------------- */

  .sourceCode {
    /* prevent unsightly overflow in wide code blocks */
    overflow: auto !important;
  }

  div.sourceCode {
    /* prevent background fill on top-most code block  container */
    background: none !important;
  }

  .sourceCode * {
    /* force consistent line spacing */
    line-height: 1.5 !important;
  }

  div.sourceCode {
    /* style code block margins same as <pre> element */
    margin-top: 20px;
    margin-bottom: 20px;
  }

  /* -------------------------------------------------- */
  /* tablenos */
  /* -------------------------------------------------- */

  /* tablenos wrapper */
  .tablenos {
    /* show scrollbar on tables if necessary to prevent overflow */
    width: 100%;
    margin: 20px 0;
  }

  .tablenos > table {
    /* move margins from table to table_wrapper to allow margin collapsing */
    margin: 0;
  }

  @media only screen {
    /* tablenos wrapper */
    .tablenos {
      /* show scrollbar on tables if necessary to prevent overflow */
      overflow-x: auto !important;
    }

    .tablenos th,
    .tablenos td {
      overflow-wrap: unset !important;
      word-break: unset !important;
    }

    /* table in wrapper */
    .tablenos table,
    .tablenos table * {
      /* don't break table words */
      overflow-wrap: normal !important;
    }
  }
</style>
<!-- 
    Plugin Core

    Functions needed for and shared across all first-party plugins.
-->

<script>
  // get element that is target of hash (from link element or url)
  function getHashTarget(link) {
    const hash = link ? link.hash : window.location.hash;
    const id = hash.slice(1);
    let target = document.querySelector(`[id="${id}"]`);
    if (!target) return;

    // if figure or table, modify target to get expected element
    if (id.indexOf("fig:") === 0) target = target.querySelector("figure");
    if (id.indexOf("tbl:") === 0) target = target.querySelector("table");

    return target;
  }

  // get position/dimensions of element or viewport
  function getRectInView(element) {
    let rect = {};
    rect.left = 0;
    rect.top = 0;
    rect.right = document.documentElement.clientWidth;
    rect.bottom = document.documentElement.clientHeight;
    let style = {};

    if (element instanceof HTMLElement) {
      rect = element.getBoundingClientRect();
      style = window.getComputedStyle(element);
    }

    const margin = {};
    margin.left = parseFloat(style.marginLeftWidth) || 0;
    margin.top = parseFloat(style.marginTopWidth) || 0;
    margin.right = parseFloat(style.marginRightWidth) || 0;
    margin.bottom = parseFloat(style.marginBottomWidth) || 0;

    const border = {};
    border.left = parseFloat(style.borderLeftWidth) || 0;
    border.top = parseFloat(style.borderTopWidth) || 0;
    border.right = parseFloat(style.borderRightWidth) || 0;
    border.bottom = parseFloat(style.borderBottomWidth) || 0;

    const newRect = {};
    newRect.left = rect.left + margin.left + border.left;
    newRect.top = rect.top + margin.top + border.top;
    newRect.right = rect.right + margin.right + border.right;
    newRect.bottom = rect.bottom + margin.bottom + border.bottom;
    newRect.width = newRect.right - newRect.left;
    newRect.height = newRect.bottom - newRect.top;

    return newRect;
  }

  // get position of element relative to page
  function getRectInPage(element) {
    const rect = getRectInView(element);
    const body = getRectInView(document.body);

    const newRect = {};
    newRect.left = rect.left - body.left;
    newRect.top = rect.top - body.top;
    newRect.right = rect.right - body.left;
    newRect.bottom = rect.bottom - body.top;
    newRect.width = rect.width;
    newRect.height = rect.height;

    return newRect;
  }

  // get closest element before specified element that matches query
  function firstBefore(element, query) {
    while (element && element !== document.body && !element.matches(query))
      element = element.previousElementSibling || element.parentNode;

    return element;
  }

  // check if element is part of collapsed heading
  function isCollapsed(element) {
    while (element && element !== document.body) {
      if (element.dataset.collapsed === "true") return true;
      element = element.parentNode;
    }
    return false;
  }

  // expand any collapsed parent containers of element if necessary
  function expandElement(element) {
    if (isCollapsed(element)) {
      // accordion plugin
      const heading = firstBefore(element, "h2");
      if (heading) heading.click();
      // details/summary HTML element
      const summary = firstBefore(element, "summary");
      if (summary) summary.click();
    }
  }

  // scroll to and focus element
  function goToElement(element, offset) {
    // expand accordion section if collapsed
    expandElement(element);
    const y =
      getRectInView(element).top -
      getRectInView(document.documentElement).top -
      (offset || 0);

    // trigger any function listening for "onscroll" event
    window.dispatchEvent(new Event("scroll"));
    window.scrollTo(0, y);
    document.activeElement.blur();
    element.focus();
  }

  // get list of elements after a start element up to element matching query
  function nextUntil(element, query, exclude) {
    const elements = [];
    while (((element = element.nextElementSibling), element)) {
      if (element.matches(query)) break;
      if (!element.matches(exclude)) elements.push(element);
    }
    return elements;
  }
</script>
<!--
  Accordion Plugin

  Allows sections of content under h2 headings to be collapsible.
-->

<script type="module">
  // whether to always start expanded ('false'), always start collapsed
  // ('true'), or start collapsed when screen small ('auto')
  const startCollapsed = "auto";

  // start script
  function start() {
    // run through each <h2> heading
    const headings = document.querySelectorAll("h2");
    for (const heading of headings) {
      addArrow(heading);

      // start expanded/collapsed based on option
      if (
        startCollapsed === "true" ||
        (startCollapsed === "auto" && isSmallScreen())
      )
        collapseHeading(heading);
      else expandElement(heading);
    }

    // attach hash change listener to window
    window.addEventListener("hashchange", onHashChange);
  }

  // when hash (eg manuscript.html#introduction) changes
  function onHashChange() {
    const target = getHashTarget();
    if (target) goToElement(target);
  }

  // add arrow to heading
  function addArrow(heading) {
    // add arrow button
    const arrow = document.createElement("button");
    arrow.innerHTML = document.querySelector(".icon_angle_down").innerHTML;
    arrow.classList.add("icon_button", "accordion_arrow");
    heading.insertBefore(arrow, heading.firstChild);

    // attach click listener to heading and button
    heading.addEventListener("click", onHeadingClick);
    arrow.addEventListener("click", onArrowClick);
  }

  // determine if on mobile-like device with small screen
  function isSmallScreen() {
    return Math.min(window.innerWidth, window.innerHeight) < 480;
  }

  // when <h2> heading is clicked
  function onHeadingClick(event) {
    // only collapse if <h2> itself is target of click (eg, user did
    // not click on anchor within <h2>)
    if (event.target === this) toggleCollapse(this);
  }

  // when arrow button is clicked
  function onArrowClick() {
    toggleCollapse(this.parentNode);
  }

  // collapse section if expanded, expand if collapsed
  function toggleCollapse(heading) {
    if (heading.dataset.collapsed === "false") collapseHeading(heading);
    else expandElement(heading);
  }

  // elements to exclude from collapse, such as table of contents panel,
  // hypothesis panel, etc
  const exclude = "#toc_panel, div.annotator-frame, #lightbox_overlay";

  // collapse section
  function collapseHeading(heading) {
    heading.setAttribute("data-collapsed", "true");
    const children = getChildren(heading);
    for (const child of children) child.setAttribute("data-collapsed", "true");
  }

  // expand section
  function expandElement(heading) {
    heading.setAttribute("data-collapsed", "false");
    const children = getChildren(heading);
    for (const child of children) child.setAttribute("data-collapsed", "false");
  }

  // get list of elements between this <h2> and next <h2> or <h1>
  // ("children" of the <h2> section)
  function getChildren(heading) {
    return nextUntil(heading, "h2, h1", exclude);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- angle down icon -->

<template class="icon_angle_down">
  <!-- modified from: https://fontawesome.com/icons/angle-down -->
  <svg width="16" height="16" viewBox="0 0 448 512">
    <path
      fill="currentColor"
      d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* accordion arrow button */
    .accordion_arrow {
      margin-right: 10px;
    }

    /* arrow icon when <h2> data-collapsed attribute true */
    h2[data-collapsed="true"] > .accordion_arrow > svg {
      transform: rotate(-90deg);
    }

    /* all elements (except <h2>'s) when data-collapsed attribute true */
    *:not(h2)[data-collapsed="true"] {
      display: none;
    }

    /* accordion arrow button when hovered and <h2>'s when hovered */
    .accordion_arrow:hover,
    h2[data-collapsed="true"]:hover,
    h2[data-collapsed="false"]:hover {
      cursor: pointer;
    }
  }

  /* always hide accordion arrow button on print */
  @media only print {
    .accordion_arrow {
      display: none;
    }
  }
</style>
<!--
  Anchors Plugin

  Adds an anchor next to each of a certain type of element that provides a
  human-readable url to that specific item/position in the document (e.g.
  "manuscript.html#abstract"). It also makes it such that scrolling out of view
  of a target removes its identifier from the url.
-->

<script type="module">
  // which types of elements to add anchors next to, in "document.querySelector"
  // format
  const typesQuery = 'h1, h2, h3, [id^="fig:"], [id^="tbl:"], [id^="eq:"]';

  // start script
  function start() {
    // add anchor to each element of specified types
    const elements = document.querySelectorAll(typesQuery);
    for (const element of elements) addAnchor(element);

    // attach scroll listener to window
    window.addEventListener("scroll", onScroll);
  }

  // when window is scrolled
  function onScroll() {
    // if url has hash and user has scrolled out of view of hash
    // target, remove hash from url
    const tolerance = 100;
    const target = getHashTarget();
    if (target) {
      if (
        target.getBoundingClientRect().top > window.innerHeight + tolerance ||
        target.getBoundingClientRect().bottom < 0 - tolerance
      )
        history.pushState(null, null, " ");
    }
  }

  // add anchor to element
  function addAnchor(element) {
    let addTo; // element to add anchor button to

    // if figure or table, modify withId and addTo to get expected
    // elements
    if (element.id.indexOf("fig:") === 0) {
      addTo = element.querySelector("figcaption");
    } else if (element.id.indexOf("tbl:") === 0) {
      addTo = element.querySelector("caption");
    } else if (element.id.indexOf("eq:") === 0) {
      addTo = element.querySelector(".eqnos-number");
    }

    addTo = addTo || element;
    const id = element.id || null;

    // do not add anchor if element doesn't have assigned id.
    // id is generated by pandoc and is assumed to be unique and
    // human-readable
    if (!id) return;

    // create anchor button
    const anchor = document.createElement("a");
    anchor.innerHTML = document.querySelector(".icon_link").innerHTML;
    anchor.title = "Link to this part of the document";
    anchor.classList.add("icon_button", "anchor");
    anchor.dataset.ignore = "true";
    anchor.href = "#" + id;
    addTo.appendChild(anchor);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- link icon -->

<template class="icon_link">
  <!-- modified from: https://fontawesome.com/icons/link -->
  <svg width="16" height="16" viewBox="0 0 512 512">
    <path
      fill="currentColor"
      d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* anchor button */
    .anchor {
      opacity: 0;
      margin-left: 5px;
    }

    /* anchor buttons within <h2>'s */
    h2 .anchor {
      margin-left: 10px;
    }

    /* anchor buttons when hovered/focused and anything containing an anchor button when hovered */
    *:hover > .anchor,
    .anchor:hover,
    .anchor:focus {
      opacity: 1;
    }

    /* anchor button when hovered */
    .anchor:hover {
      cursor: pointer;
    }
  }

  /* always show anchor button on devices with no mouse/hover ability */
  @media (hover: none) {
    .anchor {
      opacity: 1;
    }
  }

  /* always hide anchor button on print */
  @media only print {
    .anchor {
      display: none;
    }
  }
</style>
<!-- 
    Attributes Plugin

    Allows arbitrary HTML attributes to be attached to (almost) any element.
    Place an HTML comment inside or next to the desired element with the content:
    $attribute="value"
-->

<script type="module">
  // start script
  function start() {
    // get list of comments in document
    const comments = findComments();

    for (const comment of comments)
      if (comment.parentElement)
        addAttributes(comment.parentElement, comment.nodeValue.trim());
  }

  // add html attributes to specified element based on string of
  // html attributes and values
  function addAttributes(element, text) {
    // regex's for finding attribute/value pairs in the format of
    // attribute="value" or attribute='value
    const regex2 = /\$([a-zA-Z\-]+)?=\"(.+?)\"/;
    const regex1 = /\$([a-zA-Z\-]+)?=\'(.+?)\'/;

    // loop through attribute/value pairs
    let match;
    while ((match = text.match(regex2) || text.match(regex1))) {
      // get attribute and value from regex capture groups
      let attribute = match[1];
      let value = match[2];

      // remove from string
      text = text.substring(match.index + match[0].length);

      if (!attribute || !value) break;

      // set attribute of parent element
      try {
        element.setAttribute(attribute, value);
      } catch (error) {
        console.log(error);
      }

      // special case for colspan
      if (attribute === "colspan") removeTableCells(element, value);
    }
  }

  // get list of comment elements in document
  function findComments() {
    const comments = [];

    // iterate over comment nodes in document
    function acceptNode(node) {
      return NodeFilter.FILTER_ACCEPT;
    }
    const iterator = document.createNodeIterator(
      document.body,
      NodeFilter.SHOW_COMMENT,
      acceptNode
    );
    let node;
    while ((node = iterator.nextNode())) comments.push(node);

    return comments;
  }

  // remove certain number of cells after specified cell
  function removeTableCells(cell, number) {
    number = parseInt(number);
    if (!number) return;

    // remove elements
    for (; number > 1; number--) {
      if (cell.nextElementSibling) cell.nextElementSibling.remove();
    }
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>
<!--
  Jump to First Plugin

  Adds a button next to each reference entry, figure, and table that jumps the
  page to the first occurrence of a link to that item in the manuscript.
-->

<script type="module">
  // whether to add buttons next to reference entries
  const references = "true";
  // whether to add buttons next to figures
  const figures = "true";
  // whether to add buttons next to tables
  const tables = "true";

  // start script
  function start() {
    if (references !== "false") makeButtons("ref-", "p", "reference");
    if (figures !== "false") makeButtons("fig:", "figcaption", "figure");
    if (tables !== "false") makeButtons("tbl:", "caption", "table");
  }

  // when jump button clicked
  function onButtonClick() {
    const first = getFirstOccurrence(this.dataset.id);
    if (!first) return;

    // update url hash so navigating "back" in history will return user to button
    window.location.hash = this.dataset.id;
    // scroll to link
    const timeout = function () {
      goToElement(first, window.innerHeight * 0.5);
    };
    window.setTimeout(timeout, 0);
  }

  // get first occurrence of link to item in document
  function getFirstOccurrence(id) {
    let query = "a";
    query += '[href="#' + id + '"]';
    // exclude buttons, anchor links, toc links, etc
    query += ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    return document.querySelector(query);
  }

  // add button next to each reference entry, figure, or table
  function makeButtons(query, containerQuery, subject) {
    const elements = document.querySelectorAll(`[id^="${query}"`);
    for (const element of elements) {
      const id = element.id;
      const buttonContainer = element.querySelector(containerQuery);
      const first = getFirstOccurrence(id);

      // if can't find link to reference or place to put button, ignore
      if (!first || !buttonContainer) continue;

      // make jump button
      let button = document.createElement("button");
      button.classList.add("icon_button", "jump_arrow");
      button.title = `Jump to the first occurrence of this ${subject} in the document`;
      const icon = document.querySelector(".icon_angle_double_up");
      button.innerHTML = icon.innerHTML;
      button.dataset.id = id;
      button.dataset.ignore = "true";
      button.addEventListener("click", onButtonClick);
      buttonContainer.prepend(button);
    }
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- angle double up icon -->

<template class="icon_angle_double_up">
  <!-- modified from: https://fontawesome.com/icons/angle-double-up -->
  <svg width="16" height="16" viewBox="0 0 320 512">
    <path
      fill="currentColor"
      d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* jump button */
    .jump_arrow {
      position: relative;
      top: 0.125em;
      margin-right: 5px;
    }
  }

  /* always hide jump button on print */
  @media only print {
    .jump_arrow {
      display: none;
    }
  }
</style>
<!-- 
    Lightbox Plugin

    Makes it such that when a user clicks on an image, the image fills the
    screen and the user can pan/drag/zoom the image and navigate between other
    images in the document.
-->

<script type="module">
  // list of possible zoom/scale factors
  const zooms =
    "0.1, 0.25, 0.333333, 0.5, 0.666666, 0.75, 1, 1.25, 1.5, 1.75, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8";
  // whether to fit image to view ('fit'), display at 100% and shrink if
  // necessary ('shrink'), or always display at 100% ('100')
  const defaultZoom = "fit";
  // whether to zoom in/out toward center of view ('true') or mouse ('false')
  const centerZoom = "false";

  // start script
  function start() {
    // run through each <img> element
    const imgs = document.querySelectorAll("figure > img");
    let count = 1;
    for (const img of imgs) {
      img.classList.add("lightbox_document_img");
      img.dataset.number = count;
      img.dataset.total = imgs.length;
      img.addEventListener("click", openLightbox);
      count++;
    }

    // attach mouse and key listeners to window
    window.addEventListener("mousemove", onWindowMouseMove);
    window.addEventListener("keyup", onKeyUp);
  }

  // when mouse is moved anywhere in window
  function onWindowMouseMove(event) {
    window.mouseX = event.clientX;
    window.mouseY = event.clientY;
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    switch (event.key) {
      // trigger click of prev button
      case "ArrowLeft":
        const prevButton = document.getElementById("lightbox_prev_button");
        if (prevButton) prevButton.click();
        break;
      // trigger click of next button
      case "ArrowRight":
        const nextButton = document.getElementById("lightbox_next_button");
        if (nextButton) nextButton.click();
        break;
      // close on esc
      case "Escape":
        closeLightbox();
        break;
    }
  }

  // open lightbox
  function openLightbox() {
    const lightbox = makeLightbox(this);
    if (!lightbox) return;

    blurBody(lightbox);
    document.body.appendChild(lightbox);
  }

  // make lightbox
  function makeLightbox(img) {
    // delete lightbox if it exists, start fresh
    closeLightbox();

    // create screen overlay containing lightbox
    const overlay = document.createElement("div");
    overlay.id = "lightbox_overlay";

    // create image info boxes
    const numberInfo = document.createElement("div");
    const zoomInfo = document.createElement("div");
    numberInfo.id = "lightbox_number_info";
    zoomInfo.id = "lightbox_zoom_info";

    // create container for image
    const imageContainer = document.createElement("div");
    imageContainer.id = "lightbox_image_container";
    const lightboxImg = makeLightboxImg(
      img,
      imageContainer,
      numberInfo,
      zoomInfo
    );
    imageContainer.appendChild(lightboxImg);

    // create bottom container for caption and navigation buttons
    const bottomContainer = document.createElement("div");
    bottomContainer.id = "lightbox_bottom_container";
    const caption = makeCaption(img);
    const prevButton = makePrevButton(img);
    const nextButton = makeNextButton(img);
    bottomContainer.appendChild(prevButton);
    bottomContainer.appendChild(caption);
    bottomContainer.appendChild(nextButton);

    // attach top middle and bottom to overlay
    overlay.appendChild(numberInfo);
    overlay.appendChild(zoomInfo);
    overlay.appendChild(imageContainer);
    overlay.appendChild(bottomContainer);

    return overlay;
  }

  // make <img> object that is intuitively draggable and zoomable
  function makeLightboxImg(sourceImg, container, numberInfoBox, zoomInfoBox) {
    // create copy of source <img>
    const img = sourceImg.cloneNode(true);
    img.classList.remove("lightbox_document_img");
    img.removeAttribute("id");
    img.removeAttribute("width");
    img.removeAttribute("height");
    img.style.position = "unset";
    img.style.margin = "0";
    img.style.padding = "0";
    img.style.width = "";
    img.style.height = "";
    img.style.minWidth = "";
    img.style.minHeight = "";
    img.style.maxWidth = "";
    img.style.maxHeight = "";
    img.id = "lightbox_img";

    // build sorted list of zoomSteps
    const zoomSteps = zooms.split(/[^0-9.]/).map((step) => parseFloat(step));
    zoomSteps.sort((a, b) => a - b);

    // <img> object property variables
    let zoom = 1;
    let translateX = 0;
    let translateY = 0;
    let clickMouseX = undefined;
    let clickMouseY = undefined;
    let clickTranslateX = undefined;
    let clickTranslateY = undefined;

    updateNumberInfo();

    // update image numbers displayed in info box
    function updateNumberInfo() {
      numberInfoBox.innerHTML =
        sourceImg.dataset.number + " of " + sourceImg.dataset.total;
    }

    // update zoom displayed in info box
    function updateZoomInfo() {
      let zoomInfo = zoom * 100;
      if (!Number.isInteger(zoomInfo)) zoomInfo = zoomInfo.toFixed(2);
      zoomInfoBox.innerHTML = zoomInfo + "%";
    }

    // move to closest zoom step above current zoom
    const zoomIn = function () {
      for (const zoomStep of zoomSteps) {
        if (zoomStep > zoom) {
          zoom = zoomStep;
          break;
        }
      }
      updateTransform();
    };

    // move to closest zoom step above current zoom
    const zoomOut = function () {
      zoomSteps.reverse();
      for (const zoomStep of zoomSteps) {
        if (zoomStep < zoom) {
          zoom = zoomStep;
          break;
        }
      }
      zoomSteps.reverse();

      updateTransform();
    };

    // update display of <img> based on scale/translate properties
    const updateTransform = function () {
      // set transform
      img.style.transform =
        "translate(" +
        (translateX || 0) +
        "px," +
        (translateY || 0) +
        "px) scale(" +
        (zoom || 1) +
        ")";

      // get new width/height after scale
      const rect = img.getBoundingClientRect();
      // limit translate
      translateX = Math.max(translateX, -rect.width / 2);
      translateX = Math.min(translateX, rect.width / 2);
      translateY = Math.max(translateY, -rect.height / 2);
      translateY = Math.min(translateY, rect.height / 2);

      // set transform
      img.style.transform =
        "translate(" +
        (translateX || 0) +
        "px," +
        (translateY || 0) +
        "px) scale(" +
        (zoom || 1) +
        ")";

      updateZoomInfo();
    };

    // fit <img> to container
    const fit = function () {
      // no x/y offset, 100% zoom by default
      translateX = 0;
      translateY = 0;
      zoom = 1;

      // widths of <img> and container
      const imgWidth = img.naturalWidth;
      const imgHeight = img.naturalHeight;
      const containerWidth = parseFloat(
        window.getComputedStyle(container).width
      );
      const containerHeight = parseFloat(
        window.getComputedStyle(container).height
      );

      // how much zooming is needed to fit <img> to container
      const xRatio = imgWidth / containerWidth;
      const yRatio = imgHeight / containerHeight;
      const maxRatio = Math.max(xRatio, yRatio);
      const newZoom = 1 / maxRatio;

      // fit <img> to container according to option
      if (defaultZoom === "shrink") {
        if (maxRatio > 1) zoom = newZoom;
      } else if (defaultZoom === "fit") zoom = newZoom;

      updateTransform();
    };

    // when mouse wheel is rolled anywhere in container
    const onContainerWheel = function (event) {
      if (!event) return;

      // let ctrl + mouse wheel to zoom behave as normal
      if (event.ctrlKey) return;

      // prevent normal scroll behavior
      event.preventDefault();
      event.stopPropagation();

      // point around which to scale img
      const viewRect = container.getBoundingClientRect();
      const viewX = (viewRect.left + viewRect.right) / 2;
      const viewY = (viewRect.top + viewRect.bottom) / 2;
      const originX = centerZoom === "true" ? viewX : mouseX;
      const originY = centerZoom === "true" ? viewY : mouseY;

      // get point on image under origin
      const oldRect = img.getBoundingClientRect();
      const oldPercentX = (originX - oldRect.left) / oldRect.width;
      const oldPercentY = (originY - oldRect.top) / oldRect.height;

      // increment/decrement zoom
      if (event.deltaY < 0) zoomIn();
      if (event.deltaY > 0) zoomOut();

      // get offset between previous image point and origin
      const newRect = img.getBoundingClientRect();
      const offsetX = originX - (newRect.left + newRect.width * oldPercentX);
      const offsetY = originY - (newRect.top + newRect.height * oldPercentY);

      // translate image to keep image point under origin
      translateX += offsetX;
      translateY += offsetY;

      // perform translate
      updateTransform();
    };

    // when container is clicked
    function onContainerClick(event) {
      // if container itself is target of click, and not other
      // element above it
      if (event.target === this) closeLightbox();
    }

    // when mouse button is pressed on image
    const onImageMouseDown = function (event) {
      // store original mouse position relative to image
      clickMouseX = window.mouseX;
      clickMouseY = window.mouseY;
      clickTranslateX = translateX;
      clickTranslateY = translateY;
      event.stopPropagation();
      event.preventDefault();
    };

    // when mouse button is released anywhere in window
    const onWindowMouseUp = function (event) {
      // reset original mouse position
      clickMouseX = undefined;
      clickMouseY = undefined;
      clickTranslateX = undefined;
      clickTranslateY = undefined;

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("mouseup", onWindowMouseUp);
    };

    // when mouse is moved anywhere in window
    const onWindowMouseMove = function (event) {
      if (
        clickMouseX === undefined ||
        clickMouseY === undefined ||
        clickTranslateX === undefined ||
        clickTranslateY === undefined
      )
        return;

      // offset image based on original and current mouse position
      translateX = clickTranslateX + window.mouseX - clickMouseX;
      translateY = clickTranslateY + window.mouseY - clickMouseY;
      updateTransform();
      event.preventDefault();

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("mousemove", onWindowMouseMove);
    };

    // when window is resized
    const onWindowResize = function (event) {
      fit();

      // remove global listener if lightbox removed from document
      if (!document.body.contains(container))
        window.removeEventListener("resize", onWindowResize);
    };

    // attach the necessary event listeners
    img.addEventListener("dblclick", fit);
    img.addEventListener("mousedown", onImageMouseDown);
    container.addEventListener("wheel", onContainerWheel);
    container.addEventListener("mousedown", onContainerClick);
    container.addEventListener("touchstart", onContainerClick);
    window.addEventListener("mouseup", onWindowMouseUp);
    window.addEventListener("mousemove", onWindowMouseMove);
    window.addEventListener("resize", onWindowResize);

    // run fit() after lightbox atttached to document and <img> Loaded
    // so needed container and img dimensions available
    img.addEventListener("load", fit);

    return img;
  }

  // make caption
  function makeCaption(img) {
    const caption = document.createElement("div");
    caption.id = "lightbox_caption";
    const captionSource = img.nextElementSibling;
    if (captionSource.tagName.toLowerCase() === "figcaption") {
      const captionCopy = makeCopy(captionSource);
      caption.innerHTML = captionCopy.innerHTML;
    }

    caption.addEventListener("touchstart", function (event) {
      event.stopPropagation();
    });

    return caption;
  }

  // make carbon copy of html dom element
  function makeCopy(source) {
    const sourceCopy = source.cloneNode(true);

    // delete elements marked with ignore (eg anchor and jump buttons)
    const deleteFromCopy = sourceCopy.querySelectorAll('[data-ignore="true"]');
    for (const element of deleteFromCopy) element.remove();

    // delete certain element attributes
    const attributes = [
      "id",
      "data-collapsed",
      "data-selected",
      "data-highlighted",
      "data-glow",
    ];
    for (const attribute of attributes) {
      sourceCopy.removeAttribute(attribute);
      const elements = sourceCopy.querySelectorAll("[" + attribute + "]");
      for (const element of elements) element.removeAttribute(attribute);
    }

    return sourceCopy;
  }

  // make button to jump to previous image in document
  function makePrevButton(img) {
    const prevButton = document.createElement("button");
    prevButton.id = "lightbox_prev_button";
    prevButton.title = "Jump to the previous image in the document [←]";
    prevButton.classList.add("icon_button", "lightbox_button");
    prevButton.innerHTML = document.querySelector(".icon_caret_left").innerHTML;

    // attach click listeners to button
    prevButton.addEventListener("click", function () {
      getPrevImg(img).click();
    });

    return prevButton;
  }

  // make button to jump to next image in document
  function makeNextButton(img) {
    const nextButton = document.createElement("button");
    nextButton.id = "lightbox_next_button";
    nextButton.title = "Jump to the next image in the document [→]";
    nextButton.classList.add("icon_button", "lightbox_button");
    nextButton.innerHTML = document.querySelector(
      ".icon_caret_right"
    ).innerHTML;

    // attach click listeners to button
    nextButton.addEventListener("click", function () {
      getNextImg(img).click();
    });

    return nextButton;
  }

  // get previous image in document
  function getPrevImg(img) {
    const imgs = document.querySelectorAll(".lightbox_document_img");

    // find index of provided img
    let index;
    for (index = 0; index < imgs.length; index++) {
      if (imgs[index] === img) break;
    }

    // wrap index to other side if < 1
    if (index - 1 >= 0) index--;
    else index = imgs.length - 1;
    return imgs[index];
  }

  // get next image in document
  function getNextImg(img) {
    const imgs = document.querySelectorAll(".lightbox_document_img");

    // find index of provided img
    let index;
    for (index = 0; index < imgs.length; index++) {
      if (imgs[index] === img) break;
    }

    // wrap index to other side if > total
    if (index + 1 <= imgs.length - 1) index++;
    else index = 0;
    return imgs[index];
  }

  // close lightbox
  function closeLightbox() {
    focusBody();

    const lightbox = document.getElementById("lightbox_overlay");
    if (lightbox) lightbox.remove();
  }

  // make all elements behind lightbox non-focusable
  function blurBody(overlay) {
    const all = document.querySelectorAll("*");
    for (const element of all) element.tabIndex = -1;
    document.body.classList.add("body_no_scroll");
  }

  // make all elements focusable again
  function focusBody() {
    const all = document.querySelectorAll("*");
    for (const element of all) element.removeAttribute("tabIndex");
    document.body.classList.remove("body_no_scroll");
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
  <!-- modified from: https://fontawesome.com/icons/caret-left -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
    ></path>
  </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
  <!-- modified from: https://fontawesome.com/icons/caret-right -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* regular <img> in document when hovered */
    img.lightbox_document_img:hover {
      cursor: pointer;
    }

    .body_no_scroll {
      overflow: hidden !important;
    }

    /* screen overlay */
    #lightbox_overlay {
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: 3;
    }

    /* middle area containing lightbox image */
    #lightbox_image_container {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
      padding: 20px;
    }

    /* bottom area containing caption */
    #lightbox_bottom_container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100px;
      min-height: 100px;
      max-height: 100px;
      background: rgba(0, 0, 0, 0.5);
    }

    /* image number info text box */
    #lightbox_number_info {
      position: absolute;
      color: #ffffff;
      font-weight: 600;
      left: 2px;
      top: 0;
      z-index: 4;
    }

    /* zoom info text box */
    #lightbox_zoom_info {
      position: absolute;
      color: #ffffff;
      font-weight: 600;
      right: 2px;
      top: 0;
      z-index: 4;
    }

    /* copy of image caption */
    #lightbox_caption {
      box-sizing: border-box;
      display: inline-block;
      width: 100%;
      max-height: 100%;
      padding: 10px 0;
      text-align: center;
      overflow-y: auto;
      color: #ffffff;
    }

    /* navigation previous/next button */
    .lightbox_button {
      width: 100px;
      height: 100%;
      min-width: 100px;
      min-height: 100%;
      color: #ffffff;
    }

    /* navigation previous/next button when hovered */
    .lightbox_button:hover {
      background: none !important;
    }

    /* navigation button icon */
    .lightbox_button > svg {
      height: 25px;
    }

    /* figure auto-number */
    #lightbox_caption > span:first-of-type {
      font-weight: bold;
      margin-right: 5px;
    }

    /* lightbox image when hovered */
    #lightbox_img:hover {
      cursor: grab;
    }

    /* lightbox image when grabbed */
    #lightbox_img:active {
      cursor: grabbing;
    }
  }

  /* when on screen < 480px wide */
  @media only screen and (max-width: 480px) {
    /* make navigation buttons skinnier on small screens to make more room for caption text */
    .lightbox_button {
      width: 50px;
      min-width: 50px;
    }
  }

  /* always hide lightbox on print */
  @media only print {
    #lightbox_overlay {
      display: none;
    }
  }
</style>
<!-- 
  Link Highlight Plugin

  Makes it such that when a user hovers or focuses a link, other links that have
  the same target will be highlighted. It also makes it such that when clicking
  a link, the target of the link (eg reference, figure, table) is briefly
  highlighted.
-->

<script type="module">
  // whether to also highlight links that go to external urls
  const externalLinks = "false";
  // whether user must click off to unhighlight instead of just
  // un-hovering
  const clickUnhighlight = "false";
  // whether to also highlight links that are unique
  const highlightUnique = "true";

  // start script
  function start() {
    const links = getLinks();
    for (const link of links) {
      // attach mouse and focus listeners to link
      link.addEventListener("mouseenter", onLinkFocus);
      link.addEventListener("focus", onLinkFocus);
      link.addEventListener("mouseleave", onLinkUnhover);
    }

    // attach click and hash change listeners to window
    window.addEventListener("click", onClick);
    window.addEventListener("touchstart", onClick);
    window.addEventListener("hashchange", onHashChange);

    // run hash change on window load in case user has navigated
    // directly to hash
    onHashChange();
  }

  // when link is focused (tabbed to) or hovered
  function onLinkFocus() {
    highlight(this);
  }

  // when link is unhovered
  function onLinkUnhover() {
    if (clickUnhighlight !== "true") unhighlightAll();
  }

  // when the mouse is clicked anywhere in window
  function onClick(event) {
    unhighlightAll();
  }

  // when hash (eg manuscript.html#introduction) changes
  function onHashChange() {
    const target = getHashTarget();
    if (target) glowElement(target);
  }

  // start glow sequence on an element
  function glowElement(element) {
    const startGlow = function () {
      onGlowEnd();
      element.dataset.glow = "true";
      element.addEventListener("animationend", onGlowEnd);
    };
    const onGlowEnd = function () {
      element.removeAttribute("data-glow");
      element.removeEventListener("animationend", onGlowEnd);
    };
    startGlow();
  }

  // highlight link and all others with same target
  function highlight(link) {
    // force unhighlight all to start fresh
    unhighlightAll();

    // get links with same target
    if (!link) return;
    const sameLinks = getSameLinks(link);

    // if link unique and option is off, exit and don't highlight
    if (sameLinks.length <= 1 && highlightUnique !== "true") return;

    // highlight all same links, and "select" (special highlight) this
    // one
    for (const sameLink of sameLinks) {
      if (sameLink === link) sameLink.setAttribute("data-selected", "true");
      else sameLink.setAttribute("data-highlighted", "true");
    }
  }

  // unhighlight all links
  function unhighlightAll() {
    const links = getLinks();
    for (const link of links) {
      link.setAttribute("data-selected", "false");
      link.setAttribute("data-highlighted", "false");
    }
  }

  // get links with same target
  function getSameLinks(link) {
    const results = [];
    const links = getLinks();
    for (const otherLink of links) {
      if (otherLink.getAttribute("href") === link.getAttribute("href"))
        results.push(otherLink);
    }
    return results;
  }

  // get all links of types we wish to handle
  function getLinks() {
    let query = "a";
    if (externalLinks !== "true") query += '[href^="#"]';
    // exclude buttons, anchor links, toc links, etc
    query += ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    return document.querySelectorAll(query);
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<style>
  @media only screen {
    /* anything with data-highlighted attribute true */
    [data-highlighted="true"] {
      background: #ffeb3b;
    }

    /* anything with data-selected attribute true */
    [data-selected="true"] {
      background: #ff8a65 !important;
    }

    /* animation definition for glow */
    @keyframes highlight_glow {
      0% {
        background: none;
      }
      10% {
        background: #bbdefb;
      }
      100% {
        background: none;
      }
    }

    /* anything with data-glow attribute true */
    [data-glow="true"] {
      animation: highlight_glow 2s;
    }
  }
</style>
<!--
  Table of Contents Plugin

  Provides a "table of contents" (toc) panel on the side of the document that
  allows the user to conveniently navigate between sections of the document.
-->

<script type="module">
  // which types of elements to add links for, in "document.querySelector" format
  const typesQuery = "h1, h2, h3";
  // whether toc starts open. use 'true' or 'false', or 'auto' to
  // use 'true' behavior when screen wide enough and 'false' when not
  const startOpen = "false";
  // whether toc closes when clicking on toc link. use 'true' or
  // 'false', or 'auto' to use 'false' behavior when screen wide
  // enough and 'true' when not
  const clickClose = "auto";
  // if list item is more than this many characters, text will be
  // truncated
  const charLimit = "50";
  // whether or not to show bullets next to each toc item
  const bullets = "false";

  // start script
  function start() {
    // make toc panel and populate with entries (links to document
    // sections)
    const panel = makePanel();
    if (!panel) return;
    makeEntries(panel);
    // attach panel to document after making entries, so 'toc' heading
    // in panel isn't included in toc
    document.body.insertBefore(panel, document.body.firstChild);

    // initial panel state
    if (startOpen === "true" || (startOpen === "auto" && !isSmallScreen()))
      openPanel();
    else closePanel();

    // attach click, scroll, and hash change listeners to window
    window.addEventListener("click", onClick);
    window.addEventListener("scroll", onScroll);
    window.addEventListener("hashchange", onScroll);
    window.addEventListener("keyup", onKeyUp);
    onScroll();

    // add class to push document body down out of way of toc button
    document.body.classList.add("toc_body_nudge");
  }

  // determine if screen wide enough to fit toc panel
  function isSmallScreen() {
    // in default theme:
    // 816px = 8.5in = width of "page" (<body>) element
    // 260px = min width of toc panel (*2 for both sides of <body>)
    return window.innerWidth < 816 + 260 * 2;
  }

  // when mouse is clicked anywhere in window
  function onClick() {
    if (isSmallScreen()) closePanel();
  }

  // when window is scrolled or hash changed
  function onScroll() {
    highlightViewed();
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    // close on esc
    if (event.key === "Escape") closePanel();
  }

  // find entry of currently viewed document section in toc and highlight
  function highlightViewed() {
    const firstId = getFirstInView(typesQuery);

    // get toc entries (links), unhighlight all, then highlight viewed
    const list = document.getElementById("toc_list");
    if (!firstId || !list) return;
    const links = list.querySelectorAll("a");
    for (const link of links) link.dataset.viewing = "false";
    const link = list.querySelector('a[href="#' + firstId + '"]');
    if (!link) return;
    link.dataset.viewing = "true";
  }

  // get first or previous toc listed element in top half of view
  function getFirstInView(query) {
    // get all elements matching query and with id
    const elements = document.querySelectorAll(query);
    const elementsWithIds = [];
    for (const element of elements) {
      if (element.id) elementsWithIds.push(element);
    }

    // get first or previous element in top half of view
    for (let i = 0; i < elementsWithIds.length; i++) {
      const element = elementsWithIds[i];
      const prevElement = elementsWithIds[Math.max(0, i - 1)];
      if (element.getBoundingClientRect().top >= 0) {
        if (element.getBoundingClientRect().top < window.innerHeight / 2)
          return element.id;
        else return prevElement.id;
      }
    }
  }

  // make panel
  function makePanel() {
    // create panel
    const panel = document.createElement("div");
    panel.id = "toc_panel";
    if (bullets === "true") panel.dataset.bullets = "true";

    // create header
    const header = document.createElement("div");
    header.id = "toc_header";

    // create toc button
    const button = document.createElement("button");
    button.id = "toc_button";
    button.innerHTML = document.querySelector(".icon_th_list").innerHTML;
    button.title = "Table of Contents";
    button.classList.add("icon_button");

    // create header text
    const text = document.createElement("h4");
    text.innerHTML = "Table of Contents";

    // create container for toc list
    const list = document.createElement("div");
    list.id = "toc_list";

    // attach click listeners
    panel.addEventListener("click", onPanelClick);
    header.addEventListener("click", onHeaderClick);
    button.addEventListener("click", onButtonClick);

    // attach elements
    header.appendChild(button);
    header.appendChild(text);
    panel.appendChild(header);
    panel.appendChild(list);

    return panel;
  }

  // create toc entries (links) to each element of the specified types
  function makeEntries(panel) {
    const elements = document.querySelectorAll(typesQuery);
    for (const element of elements) {
      // do not add link if element doesn't have assigned id
      if (!element.id) continue;

      // create link/list item
      const link = document.createElement("a");
      link.classList.add("toc_link");
      switch (element.tagName.toLowerCase()) {
        case "h1":
          link.dataset.level = "1";
          break;
        case "h2":
          link.dataset.level = "2";
          break;
        case "h3":
          link.dataset.level = "3";
          break;
        case "h4":
          link.dataset.level = "4";
          break;
      }
      link.title = element.innerText;
      let text = element.innerText;
      if (text.length > charLimit) text = text.slice(0, charLimit) + "...";
      link.innerHTML = text;
      link.href = "#" + element.id;
      link.addEventListener("click", onLinkClick);

      // attach link
      panel.querySelector("#toc_list").appendChild(link);
    }
  }

  // when panel is clicked
  function onPanelClick(event) {
    // stop click from propagating to window/document and closing panel
    event.stopPropagation();
  }

  // when header itself is clicked
  function onHeaderClick(event) {
    togglePanel();
  }

  // when button is clicked
  function onButtonClick(event) {
    togglePanel();
    // stop header underneath button from also being clicked
    event.stopPropagation();
  }

  // when link is clicked
  function onLinkClick(event) {
    if (clickClose === "true" || (clickClose === "auto" && isSmallScreen()))
      closePanel();
    else openPanel();
  }

  // open panel if closed, close if opened
  function togglePanel() {
    const panel = document.getElementById("toc_panel");
    if (!panel) return;

    if (panel.dataset.open === "true") closePanel();
    else openPanel();
  }

  // open panel
  function openPanel() {
    const panel = document.getElementById("toc_panel");
    if (panel) panel.dataset.open = "true";
  }

  // close panel
  function closePanel() {
    const panel = document.getElementById("toc_panel");
    if (panel) panel.dataset.open = "false";
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- th list icon -->

<template class="icon_th_list">
  <!-- modified from: https://fontawesome.com/icons/th-list -->
  <svg width="16" height="16" viewBox="0 0 512 512" tabindex="-1">
    <path
      fill="currentColor"
      d="M96 96c0 26.51-21.49 48-48 48S0 122.51 0 96s21.49-48 48-48 48 21.49 48 48zM48 208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm0 160c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm96-236h352c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h352c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H144c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"
      tabindex="-1"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* toc panel */
    #toc_panel {
      box-sizing: border-box;
      position: fixed;
      top: 0;
      left: 0;
      background: #ffffff;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      z-index: 2;
    }

    /* toc panel when closed */
    #toc_panel[data-open="false"] {
      min-width: 60px;
      width: 60px;
      height: 60px;
      border-right: solid 1px #bdbdbd;
      border-bottom: solid 1px #bdbdbd;
    }

    /* toc panel when open */
    #toc_panel[data-open="true"] {
      min-width: 260px;
      max-width: 480px;
      /* keep panel edge consistent distance away from "page" edge */
      width: calc(((100vw - 8.5in) / 2) - 30px - 40px);
      bottom: 0;
      border-right: solid 1px #bdbdbd;
    }

    /* toc panel header */
    #toc_header {
      box-sizing: border-box;
      display: flex;
      flex-direction: row;
      align-items: center;
      height: 60px;
      margin: 0;
      padding: 20px;
    }

    /* toc panel header when hovered */
    #toc_header:hover {
      cursor: pointer;
    }

    /* toc panel header when panel open */
    #toc_panel[data-open="true"] > #toc_header {
      border-bottom: solid 1px #bdbdbd;
    }

    /* toc open/close header button */
    #toc_button {
      margin-right: 20px;
    }

    /* hide toc list and header text when closed */
    #toc_panel[data-open="false"] > #toc_header > *:not(#toc_button),
    #toc_panel[data-open="false"] > #toc_list {
      display: none;
    }

    /* toc list of entries */
    #toc_list {
      box-sizing: border-box;
      width: 100%;
      padding: 20px;
      position: absolute;
      top: calc(60px + 1px);
      bottom: 0;
      overflow: auto;
    }

    /* toc entry, link to section in document */
    .toc_link {
      display: block;
      padding: 5px;
      position: relative;
      font-weight: 600;
      text-decoration: none;
    }

    /* toc entry when hovered or when "viewed" */
    .toc_link:hover,
    .toc_link[data-viewing="true"] {
      background: #f5f5f5;
    }

    /* toc entry, level 1 indentation */
    .toc_link[data-level="1"] {
      margin-left: 0;
    }

    /* toc entry, level 2 indentation */
    .toc_link[data-level="2"] {
      margin-left: 20px;
    }

    /* toc entry, level 3 indentation */
    .toc_link[data-level="3"] {
      margin-left: 40px;
    }

    /* toc entry, level 4 indentation */
    .toc_link[data-level="4"] {
      margin-left: 60px;
    }

    /* toc entry bullets */
    #toc_panel[data-bullets="true"] .toc_link[data-level]:before {
      position: absolute;
      left: -15px;
      top: -1px;
      font-size: 1.5em;
    }

    /* toc entry, level 2 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="2"]:before {
      content: "\2022";
    }

    /* toc entry, level 3 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="3"]:before {
      content: "\25AB";
    }

    /* toc entry, level 4 bullet */
    #toc_panel[data-bullets="true"] .toc_link[data-level="4"]:before {
      content: "-";
    }
  }

  /* when on screen < 8.5in wide */
  @media only screen and (max-width: 8.5in) {
    /* push <body> ("page") element down to make room for toc icon */
    .toc_body_nudge {
      padding-top: 60px;
    }

    /* toc icon when panel closed and not hovered */
    #toc_panel[data-open="false"]:not(:hover) {
      background: rgba(255, 255, 255, 0.75);
    }
  }

  /* always hide toc panel on print */
  @media only print {
    #toc_panel {
      display: none;
    }
  }
</style>
<!-- 
  Tooltips Plugin

  Makes it such that when the user hovers or focuses a link to a citation or
  figure, a tooltip appears with a preview of the reference content, along with
  arrows to navigate between instances of the same reference in the document.
-->

<script type="module">
  // whether user must click off to close tooltip instead of just un-hovering
  const clickClose = "false";
  // delay (in ms) between opening and closing tooltip
  const delay = "100";

  // start script
  function start() {
    const links = getLinks();
    for (const link of links) {
      // attach hover and focus listeners to link
      link.addEventListener("mouseover", onLinkHover);
      link.addEventListener("mouseleave", onLinkUnhover);
      link.addEventListener("focus", onLinkFocus);
      link.addEventListener("touchend", onLinkTouch);
    }

    // attach mouse, key, and resize listeners to window
    window.addEventListener("mousedown", onClick);
    window.addEventListener("touchstart", onClick);
    window.addEventListener("keyup", onKeyUp);
    window.addEventListener("resize", onResize);
  }

  // when link is hovered
  function onLinkHover() {
    // function to open tooltip
    const delayOpenTooltip = function () {
      openTooltip(this);
    }.bind(this);

    // run open function after delay
    this.openTooltipTimer = window.setTimeout(delayOpenTooltip, delay);
  }

  // when mouse leaves link
  function onLinkUnhover() {
    // cancel opening tooltip
    window.clearTimeout(this.openTooltipTimer);

    // don't close on unhover if option specifies
    if (clickClose === "true") return;

    // function to close tooltip
    const delayCloseTooltip = function () {
      // if tooltip open and if mouse isn't over tooltip, close
      const tooltip = document.getElementById("tooltip");
      if (tooltip && !tooltip.matches(":hover")) closeTooltip();
    };

    // run close function after delay
    this.closeTooltipTimer = window.setTimeout(delayCloseTooltip, delay);
  }

  // when link is focused (tabbed to)
  function onLinkFocus(event) {
    openTooltip(this);
  }

  // when link is touched on touch screen
  function onLinkTouch(event) {
    // attempt to force hover state on first tap always, and trigger
    // regular link click (and navigation) on second tap
    if (event.target === document.activeElement) event.target.click();
    else {
      document.activeElement.blur();
      event.target.focus();
    }
    if (event.cancelable) event.preventDefault();
    event.stopPropagation();
    return false;
  }

  // when mouse is clicked anywhere in window
  function onClick(event) {
    closeTooltip();
  }

  // when key pressed
  function onKeyUp(event) {
    if (!event || !event.key) return;

    switch (event.key) {
      // trigger click of prev button
      case "ArrowLeft":
        const prevButton = document.getElementById("tooltip_prev_button");
        if (prevButton) prevButton.click();
        break;
      // trigger click of next button
      case "ArrowRight":
        const nextButton = document.getElementById("tooltip_next_button");
        if (nextButton) nextButton.click();
        break;
      // close on esc
      case "Escape":
        closeTooltip();
        break;
    }
  }

  // when window is resized or zoomed
  function onResize() {
    closeTooltip();
  }

  // get all links of types we wish to handle
  function getLinks() {
    const queries = [];
    // exclude buttons, anchor links, toc links, etc
    const exclude =
      ":not(.button):not(.icon_button):not(.anchor):not(.toc_link)";
    queries.push('a[href^="#ref-"]' + exclude); // citation links
    queries.push('a[href^="#fig:"]' + exclude); // figure links
    const query = queries.join(", ");
    return document.querySelectorAll(query);
  }

  // get links with same target, get index of link in set, get total
  // same links
  function getSameLinks(link) {
    const sameLinks = [];
    const links = getLinks();
    for (const otherLink of links) {
      if (otherLink.getAttribute("href") === link.getAttribute("href"))
        sameLinks.push(otherLink);
    }

    return {
      elements: sameLinks,
      index: sameLinks.indexOf(link),
      total: sameLinks.length,
    };
  }

  // open tooltip
  function openTooltip(link) {
    // delete tooltip if it exists, start fresh
    closeTooltip();

    // make tooltip element
    const tooltip = makeTooltip(link);

    // if source couldn't be found and tooltip not made, exit
    if (!tooltip) return;

    // make navbar elements
    const navBar = makeNavBar(link);
    if (navBar) tooltip.firstElementChild.appendChild(navBar);

    // attach tooltip to page
    document.body.appendChild(tooltip);

    // position tooltip
    const position = function () {
      positionTooltip(link);
    };
    position();

    // if tooltip contains images, position again after they've loaded
    const imgs = tooltip.querySelectorAll("img");
    for (const img of imgs) img.addEventListener("load", position);
  }

  // close (delete) tooltip
  function closeTooltip() {
    const tooltip = document.getElementById("tooltip");
    if (tooltip) tooltip.remove();
  }

  // make tooltip
  function makeTooltip(link) {
    // get target element that link points to
    const source = getSource(link);

    // if source can't be found, exit
    if (!source) return;

    // create new tooltip
    const tooltip = document.createElement("div");
    tooltip.id = "tooltip";
    const tooltipContent = document.createElement("div");
    tooltipContent.id = "tooltip_content";
    tooltip.appendChild(tooltipContent);

    // make copy of source node and put in tooltip
    const sourceCopy = makeCopy(source);
    tooltipContent.appendChild(sourceCopy);

    // attach mouse event listeners
    tooltip.addEventListener("click", onTooltipClick);
    tooltip.addEventListener("mousedown", onTooltipClick);
    tooltip.addEventListener("touchstart", onTooltipClick);
    tooltip.addEventListener("mouseleave", onTooltipUnhover);

    // (for interaction with lightbox plugin)
    // transfer click on tooltip copied img to original img
    const sourceImg = source.querySelector("img");
    const sourceCopyImg = sourceCopy.querySelector("img");
    if (sourceImg && sourceCopyImg) {
      const clickImg = function () {
        sourceImg.click();
        closeTooltip();
      };
      sourceCopyImg.addEventListener("click", clickImg);
    }

    return tooltip;
  }

  // make carbon copy of html dom element
  function makeCopy(source) {
    const sourceCopy = source.cloneNode(true);

    // delete elements marked with ignore (eg anchor and jump buttons)
    const deleteFromCopy = sourceCopy.querySelectorAll('[data-ignore="true"]');
    for (const element of deleteFromCopy) element.remove();

    // delete certain element attributes
    const attributes = [
      "id",
      "data-collapsed",
      "data-selected",
      "data-highlighted",
      "data-glow",
    ];
    for (const attribute of attributes) {
      sourceCopy.removeAttribute(attribute);
      const elements = sourceCopy.querySelectorAll("[" + attribute + "]");
      for (const element of elements) element.removeAttribute(attribute);
    }

    return sourceCopy;
  }

  // when tooltip is clicked
  function onTooltipClick(event) {
    // when user clicks on tooltip, stop click from transferring
    // outside of tooltip (eg, click off to close tooltip, or eg click
    // off to unhighlight same refs)
    event.stopPropagation();
  }

  // when tooltip is unhovered
  function onTooltipUnhover(event) {
    if (clickClose === "true") return;

    // make sure new mouse/touch/focus no longer over tooltip or any
    // element within it
    const tooltip = document.getElementById("tooltip");
    if (!tooltip) return;
    if (this.contains(event.relatedTarget)) return;

    closeTooltip();
  }

  // make nav bar to go betwen prev/next instances of same reference
  function makeNavBar(link) {
    // find other links to the same source
    const sameLinks = getSameLinks(link);

    // don't show nav bar when singular reference
    if (sameLinks.total <= 1) return;

    // find prev/next links with same target
    const prevLink = getPrevLink(link, sameLinks);
    const nextLink = getNextLink(link, sameLinks);

    // create nav bar
    const navBar = document.createElement("div");
    navBar.id = "tooltip_nav_bar";
    const text = sameLinks.index + 1 + " of " + sameLinks.total;

    // create nav bar prev/next buttons
    const prevButton = document.createElement("button");
    const nextButton = document.createElement("button");
    prevButton.id = "tooltip_prev_button";
    nextButton.id = "tooltip_next_button";
    prevButton.title =
      "Jump to the previous occurence of this item in the document [←]";
    nextButton.title =
      "Jump to the next occurence of this item in the document [→]";
    prevButton.classList.add("icon_button");
    nextButton.classList.add("icon_button");
    prevButton.innerHTML = document.querySelector(".icon_caret_left").innerHTML;
    nextButton.innerHTML = document.querySelector(
      ".icon_caret_right"
    ).innerHTML;
    navBar.appendChild(prevButton);
    navBar.appendChild(document.createTextNode(text));
    navBar.appendChild(nextButton);

    // attach click listeners to buttons
    prevButton.addEventListener("click", function () {
      onPrevNextClick(link, prevLink);
    });
    nextButton.addEventListener("click", function () {
      onPrevNextClick(link, nextLink);
    });

    return navBar;
  }

  // get previous link with same target
  function getPrevLink(link, sameLinks) {
    if (!sameLinks) sameLinks = getSameLinks(link);
    // wrap index to other side if < 1
    let index;
    if (sameLinks.index - 1 >= 0) index = sameLinks.index - 1;
    else index = sameLinks.total - 1;
    return sameLinks.elements[index];
  }

  // get next link with same target
  function getNextLink(link, sameLinks) {
    if (!sameLinks) sameLinks = getSameLinks(link);
    // wrap index to other side if > total
    let index;
    if (sameLinks.index + 1 <= sameLinks.total - 1) index = sameLinks.index + 1;
    else index = 0;
    return sameLinks.elements[index];
  }

  // get element that is target of link or url hash
  function getSource(link) {
    const hash = link ? link.hash : window.location.hash;
    const id = hash.slice(1);
    let target = document.querySelector('[id="' + id + '"]');
    if (!target) return;

    // if ref or figure, modify target to get expected element
    if (id.indexOf("ref-") === 0) target = target.querySelector("p");
    else if (id.indexOf("fig:") === 0) target = target.querySelector("figure");

    return target;
  }

  // when prev/next arrow button is clicked
  function onPrevNextClick(link, prevNextLink) {
    if (link && prevNextLink)
      goToElement(prevNextLink, window.innerHeight * 0.5);
  }

  // scroll to and focus element
  function goToElement(element, offset) {
    // expand accordion section if collapsed
    expandElement(element);
    const y =
      getRectInView(element).top -
      getRectInView(document.documentElement).top -
      (offset || 0);
    // trigger any function listening for "onscroll" event
    window.dispatchEvent(new Event("scroll"));
    window.scrollTo(0, y);
    document.activeElement.blur();
    element.focus();
  }

  // determine position to place tooltip based on link position in
  // viewport and tooltip size
  function positionTooltip(link, left, top) {
    const tooltipElement = document.getElementById("tooltip");
    if (!tooltipElement) return;

    // get convenient vars for position/dimensions of
    // link/tooltip/page/view
    link = getRectInPage(link);
    const tooltip = getRectInPage(tooltipElement);
    const view = getRectInPage();

    // horizontal positioning
    if (left)
      // use explicit value
      left = left;
    else if (link.left + tooltip.width < view.right)
      // fit tooltip to right of link
      left = link.left;
    else if (link.right - tooltip.width > view.left)
      // fit tooltip to left of link
      left = link.right - tooltip.width;
    // center tooltip in view
    else left = (view.right - view.left) / 2 - tooltip.width / 2;

    // vertical positioning
    if (top)
      // use explicit value
      top = top;
    else if (link.top - tooltip.height > view.top)
      // fit tooltip above link
      top = link.top - tooltip.height;
    else if (link.bottom + tooltip.height < view.bottom)
      // fit tooltip below link
      top = link.bottom;
    else {
      // center tooltip in view
      top = view.top + view.height / 2 - tooltip.height / 2;
      // nudge off of link to left/right if possible
      if (link.right + tooltip.width < view.right) left = link.right;
      else if (link.left - tooltip.width > view.left)
        left = link.left - tooltip.width;
    }

    tooltipElement.style.left = left + "px";
    tooltipElement.style.top = top + "px";
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- caret left icon -->

<template class="icon_caret_left">
  <!-- modified from: https://fontawesome.com/icons/caret-left -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M192 127.338v257.324c0 17.818-21.543 26.741-34.142 14.142L29.196 270.142c-7.81-7.81-7.81-20.474 0-28.284l128.662-128.662c12.599-12.6 34.142-3.676 34.142 14.142z"
    ></path>
  </svg>
</template>

<!-- caret right icon -->

<template class="icon_caret_right">
  <!-- modified from: https://fontawesome.com/icons/caret-right -->
  <svg width="16" height="16" viewBox="0 0 192 512">
    <path
      fill="currentColor"
      d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"
    ></path>
  </svg>
</template>

<style>
  @media only screen {
    /* tooltip container */
    #tooltip {
      position: absolute;
      width: 50%;
      min-width: 240px;
      max-width: 75%;
      z-index: 1;
    }

    /* tooltip content */
    #tooltip_content {
      margin-bottom: 5px;
      padding: 20px;
      border-radius: 5px;
      border: solid 1px #bdbdbd;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
      background: #ffffff;
      overflow-wrap: break-word;
    }

    /* tooltip copy of paragraphs and figures */
    #tooltip_content > p,
    #tooltip_content > figure {
      margin: 0;
      max-height: 320px;
      overflow-y: auto;
    }

    /* tooltip copy of <img> */
    #tooltip_content > figure > img,
    #tooltip_content > figure > svg {
      max-height: 260px;
    }

    /* navigation bar */
    #tooltip_nav_bar {
      margin-top: 10px;
      text-align: center;
    }

    /* navigation bar previous/next buton */
    #tooltip_nav_bar > .icon_button {
      position: relative;
      top: 3px;
    }

    /* navigation bar previous button */
    #tooltip_nav_bar > .icon_button:first-of-type {
      margin-right: 5px;
    }

    /* navigation bar next button */
    #tooltip_nav_bar > .icon_button:last-of-type {
      margin-left: 5px;
    }
  }

  /* always hide tooltip on print */
  @media only print {
    #tooltip {
      display: none;
    }
  }
</style>
<!--
  Analytics Plugin (third-party) 
  
  Copy and paste code from Google Analytics or similar service here.
-->
<!-- 
  Annotations Plugin

  Allows public annotation of the  manuscript. See https://web.hypothes.is/.
-->

<script>
  // configuration
  window.hypothesisConfig = function () {
    return {
      branding: {
        accentColor: "#2196f3",
        appBackgroundColor: "#f8f8f8",
        ctaBackgroundColor: "#f8f8f8",
        ctaTextColor: "#000000",
        selectionFontFamily: "Open Sans, Helvetica, sans serif",
        annotationFontFamily: "Open Sans, Helvetica, sans serif",
      },
    };
  };

  // hypothesis client script
  const embed = "https://hypothes.is/embed.js";
  // hypothesis annotation count query url
  const query = "https://api.hypothes.is/api/search?limit=0&url=";

  // start script
  function start() {
    const button = makeButton();
    document.body.insertBefore(button, document.body.firstChild);
    insertCount(button);
  }

  // make button
  function makeButton() {
    // create button
    const button = document.createElement("button");
    button.id = "hypothesis_button";
    button.innerHTML = document.querySelector(".icon_hypothesis").innerHTML;
    button.title = "Hypothesis annotations";
    button.classList.add("icon_button");

    function onClick(event) {
      onButtonClick(event, button);
    }

    // attach click listeners
    button.addEventListener("click", onClick);

    return button;
  }

  // insert annotations count
  async function insertCount(button) {
    // get annotation count from Hypothesis based on url
    let count = "-";
    try {
      const canonical = document.querySelector('link[rel="canonical"]');
      const location = window.location;
      const url = encodeURIComponent((canonical || location).href);
      const response = await fetch(query + url);
      const json = await response.json();
      count = json.total || "-";
    } catch (error) {
      console.log(error);
    }

    // put count into button
    const counter = document.createElement("span");
    counter.id = "hypothesis_count";
    counter.innerHTML = count;
    button.title = "View " + count + " Hypothesis annotations";
    button.append(counter);
  }

  // when button is clicked
  function onButtonClick(event, button) {
    const script = document.createElement("script");
    script.src = embed;
    document.body.append(script);
    button.remove();
  }

  // start script when document is finished loading
  window.addEventListener("load", start);
</script>

<!-- hypothesis icon -->

<template class="icon_hypothesis">
  <!-- modified from: https://simpleicons.org/icons/hypothesis.svg / https://git.io/Jf1VB -->
  <svg width="16" height="16" viewBox="0 0 24 24" tabindex="-1">
    <path
      fill="currentColor"
      d="M3.43 0C2.5 0 1.72 .768 1.72 1.72V18.86C1.72 19.8 2.5 20.57 3.43 20.57H9.38L12 24L14.62 20.57H20.57C21.5 20.57 22.29 19.8 22.29 18.86V1.72C22.29 .77 21.5 0 20.57 0H3.43M5.14 3.43H7.72V9.43S8.58 7.72 10.28 7.72C12 7.72 13.74 8.57 13.74 11.24V17.14H11.16V12C11.16 10.61 10.28 10.07 9.43 10.29C8.57 10.5 7.72 11.41 7.72 13.29V17.14H5.14V3.43M18 13.72C18.95 13.72 19.72 14.5 19.72 15.42A1.71 1.71 0 0 1 18 17.13A1.71 1.71 0 0 1 16.29 15.42C16.29 14.5 17.05 13.71 18 13.71Z"
      tabindex="-1"
    ></path>
  </svg>
</template>

<style>
  /* hypothesis activation button */
  #hypothesis_button {
    box-sizing: border-box;
    position: fixed;
    top: 0;
    right: 0;
    width: 60px;
    height: 60px;
    background: #ffffff;
    border-radius: 0;
    border-left: solid 1px #bdbdbd;
    border-bottom: solid 1px #bdbdbd;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
    z-index: 2;
  }

  /* hypothesis button svg */
  #hypothesis_button > svg {
    position: relative;
    top: -4px;
  }

  /* hypothesis annotation count */
  #hypothesis_count {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 5px;
  }

  /* side panel */
  .annotator-frame {
    width: 280px !important;
  }

  /* match highlight color to rest of theme */
  .annotator-highlights-always-on .annotator-hl {
    background-color: #ffeb3b !important;
  }

  /* match focused color to rest of theme */
  .annotator-hl.annotator-hl-focused {
    background-color: #ff8a65 !important;
  }

  /* match bucket bar color to rest of theme */
  .annotator-bucket-bar {
    background: #f5f5f5 !important;
  }

  /* always hide button, toolbar, and tooltip on print */
  @media only print {
    #hypothesis_button {
      display: none;
    }

    .annotator-frame {
      display: none !important;
    }

    hypothesis-adder {
      display: none !important;
    }
  }
</style>
<!-- 
  Mathjax Plugin (third-party) 

  Allows the proper rendering of math/equations written in LaTeX.
  See https://www.mathjax.org/.
-->

<script type="text/x-mathjax-config">
  // configuration
  MathJax.Hub.Config({
    "CommonHTML": { linebreaks: { automatic: true } },
    "HTML-CSS": { linebreaks: { automatic: true } },
    "SVG": { linebreaks: { automatic: true } },
    "fast-preview": { disabled: true }
  });
</script>

<script
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"
  integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A=="
  crossorigin="anonymous"
></script>

<style>
  /* mathjax containers */
  .math.display > span:not(.MathJax_Preview) {
    /* turn inline element (no dimensions) into block (allows fixed width and thus scrolling) */
    display: flex !important;
    overflow-x: auto !important;
    overflow-y: hidden !important;
    justify-content: center;
    align-items: center;
    margin: 0 !important;
  }

  /* right click menu */
  .MathJax_Menu {
    border-radius: 5px !important;
    border: solid 1px #bdbdbd !important;
    box-shadow: none !important;
  }

  /* equation auto-number */
  span[id^="eq:"] > span.math.display + span {
    font-weight: 600;
  }

  /* equation */
  span[id^="eq:"] > span.math.display > span {
    /* nudge to make room for equation auto-number and anchor */
    margin-right: 60px !important;
  }
</style>
</body>
</html>
